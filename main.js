"use strict";(()=>{var _r=Object.defineProperty,a=(n,t)=>_r(n,"name",{value:t,configurable:!0}),$r=(()=>{for(var n=new Uint8Array(128),t=0;t<64;t++)n[t<26?t+65:t<52?t+71:t<62?t-4:t*4-205]=t;return h=>{for(var f=h.length,y=new Uint8Array((f-(h[f-1]=="=")-(h[f-2]=="="))*3/4|0),M=0,P=0;M<f;){var q=n[h.charCodeAt(M++)],W=n[h.charCodeAt(M++)],x=n[h.charCodeAt(M++)],Y=n[h.charCodeAt(M++)];y[P++]=q<<2|W>>4,y[P++]=W<<4|x>>2,y[P++]=x<<6|Y}return y}})();function Te(n){return n*Math.PI/180}a(Te,"deg2rad");function Pt(n){return n*180/Math.PI}a(Pt,"rad2deg");function Ge(n,t,h){return t>h?Ge(n,h,t):Math.min(Math.max(n,t),h)}a(Ge,"clamp");function Ce(n,t,h){if(typeof n=="number"&&typeof t=="number")return n+(t-n)*h;if(n instanceof E&&t instanceof E||n instanceof _&&t instanceof _)return n.lerp(t,h);throw new Error(`Bad value for lerp(): ${n}, ${t}. Only number, Vec2 and Color is supported.`)}a(Ce,"lerp");function Xe(n,t,h,f,y){return f+(n-t)/(h-t)*(y-f)}a(Xe,"map");function er(n,t,h,f,y){return Ge(Xe(n,t,h,f,y),f,y)}a(er,"mapc");var E=class xe{static{a(this,"Vec2")}x=0;y=0;constructor(t=0,h=t){this.x=t,this.y=h}static fromAngle(t){let h=Te(t);return new xe(Math.cos(h),Math.sin(h))}static LEFT=new xe(-1,0);static RIGHT=new xe(1,0);static UP=new xe(0,-1);static DOWN=new xe(0,1);clone(){return new xe(this.x,this.y)}add(...t){let h=B(...t);return new xe(this.x+h.x,this.y+h.y)}sub(...t){let h=B(...t);return new xe(this.x-h.x,this.y-h.y)}scale(...t){let h=B(...t);return new xe(this.x*h.x,this.y*h.y)}dist(...t){let h=B(...t);return this.sub(h).len()}sdist(...t){let h=B(...t);return this.sub(h).slen()}len(){return Math.sqrt(this.dot(this))}slen(){return this.dot(this)}unit(){let t=this.len();return t===0?new xe(0):this.scale(1/t)}normal(){return new xe(this.y,-this.x)}reflect(t){return this.sub(t.scale(2*this.dot(t)))}project(t){return t.scale(t.dot(this)/t.len())}reject(t){return this.sub(this.project(t))}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}angle(...t){let h=B(...t);return Pt(Math.atan2(this.y-h.y,this.x-h.x))}angleBetween(...t){let h=B(...t);return Pt(Math.atan2(this.cross(h),this.dot(h)))}lerp(t,h){return new xe(Ce(this.x,t.x,h),Ce(this.y,t.y,h))}slerp(t,h){let f=this.dot(t),y=this.cross(t),M=Math.atan2(y,f);return this.scale(Math.sin((1-h)*M)).add(t.scale(Math.sin(h*M))).scale(1/y)}isZero(){return this.x===0&&this.y===0}toFixed(t){return new xe(Number(this.x.toFixed(t)),Number(this.y.toFixed(t)))}transform(t){return t.multVec2(this)}eq(t){return this.x===t.x&&this.y===t.y}bbox(){return new Ve(this,0,0)}toString(){return`vec2(${this.x.toFixed(2)}, ${this.y.toFixed(2)})`}};function B(...n){if(n.length===1){if(n[0]instanceof E)return new E(n[0].x,n[0].y);if(Array.isArray(n[0])&&n[0].length===2)return new E(...n[0])}return new E(...n)}a(B,"vec2");var _=class ae{static{a(this,"Color")}r=255;g=255;b=255;constructor(t,h,f){this.r=Ge(t,0,255),this.g=Ge(h,0,255),this.b=Ge(f,0,255)}static fromArray(t){return new ae(t[0],t[1],t[2])}static fromHex(t){if(typeof t=="number")return new ae(t>>16&255,t>>8&255,t>>0&255);if(typeof t=="string"){let h=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return new ae(parseInt(h[1],16),parseInt(h[2],16),parseInt(h[3],16))}else throw new Error("Invalid hex color format")}static fromHSL(t,h,f){if(h==0)return new ae(255*f,255*f,255*f);let y=a((Y,c,$)=>($<0&&($+=1),$>1&&($-=1),$<1/6?Y+(c-Y)*6*$:$<1/2?c:$<2/3?Y+(c-Y)*(2/3-$)*6:Y),"hue2rgb"),M=f<.5?f*(1+h):f+h-f*h,P=2*f-M,q=y(P,M,t+1/3),W=y(P,M,t),x=y(P,M,t-1/3);return new ae(Math.round(q*255),Math.round(W*255),Math.round(x*255))}static RED=new ae(255,0,0);static GREEN=new ae(0,255,0);static BLUE=new ae(0,0,255);static YELLOW=new ae(255,255,0);static MAGENTA=new ae(255,0,255);static CYAN=new ae(0,255,255);static WHITE=new ae(255,255,255);static BLACK=new ae(0,0,0);clone(){return new ae(this.r,this.g,this.b)}lighten(t){return new ae(this.r+t,this.g+t,this.b+t)}darken(t){return this.lighten(-t)}invert(){return new ae(255-this.r,255-this.g,255-this.b)}mult(t){return new ae(this.r*t.r/255,this.g*t.g/255,this.b*t.b/255)}lerp(t,h){return new ae(Ce(this.r,t.r,h),Ce(this.g,t.g,h),Ce(this.b,t.b,h))}toHSL(){let t=this.r/255,h=this.g/255,f=this.b/255,y=Math.max(t,h,f),M=Math.min(t,h,f),P=(y+M)/2,q=P,W=P;if(y==M)P=q=0;else{let x=y-M;switch(q=W>.5?x/(2-y-M):x/(y+M),y){case t:P=(h-f)/x+(h<f?6:0);break;case h:P=(f-t)/x+2;break;case f:P=(t-h)/x+4;break}P/=6}return[P,q,W]}eq(t){return this.r===t.r&&this.g===t.g&&this.b===t.b}toString(){return`rgb(${this.r}, ${this.g}, ${this.b})`}toHex(){return"#"+((1<<24)+(this.r<<16)+(this.g<<8)+this.b).toString(16).slice(1)}};function Z(...n){if(n.length===0){if(n[0]instanceof _)return n[0].clone();if(typeof n[0]=="string")return _.fromHex(n[0]);if(Array.isArray(n[0])&&n[0].length===3)return _.fromArray(n[0])}return new _(...n)}a(Z,"rgb");var eo=a((n,t,h)=>_.fromHSL(n,t,h),"hsl2rgb"),me=class oi{static{a(this,"Quad")}x=0;y=0;w=1;h=1;constructor(t,h,f,y){this.x=t,this.y=h,this.w=f,this.h=y}scale(t){return new oi(this.x+this.w*t.x,this.y+this.h*t.y,this.w*t.w,this.h*t.h)}pos(){return new E(this.x,this.y)}clone(){return new oi(this.x,this.y,this.w,this.h)}eq(t){return this.x===t.x&&this.y===t.y&&this.w===t.w&&this.h===t.h}toString(){return`quad(${this.x}, ${this.y}, ${this.w}, ${this.h})`}};function re(n,t,h,f){return new me(n,t,h,f)}a(re,"quad");var Pe=class Oe{static{a(this,"Mat4")}m=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];constructor(t){t&&(this.m=t)}static translate(t){return new Oe([1,0,0,0,0,1,0,0,0,0,1,0,t.x,t.y,0,1])}static scale(t){return new Oe([t.x,0,0,0,0,t.y,0,0,0,0,1,0,0,0,0,1])}static rotateX(t){t=Te(-t);let h=Math.cos(t),f=Math.sin(t);return new Oe([1,0,0,0,0,h,-f,0,0,f,h,0,0,0,0,1])}static rotateY(t){t=Te(-t);let h=Math.cos(t),f=Math.sin(t);return new Oe([h,0,f,0,0,1,0,0,-f,0,h,0,0,0,0,1])}static rotateZ(t){t=Te(-t);let h=Math.cos(t),f=Math.sin(t);return new Oe([h,-f,0,0,f,h,0,0,0,0,1,0,0,0,0,1])}translate(t){return this.m[12]+=this.m[0]*t.x+this.m[4]*t.y,this.m[13]+=this.m[1]*t.x+this.m[5]*t.y,this.m[14]+=this.m[2]*t.x+this.m[6]*t.y,this.m[15]+=this.m[3]*t.x+this.m[7]*t.y,this}scale(t){return this.m[0]*=t.x,this.m[4]*=t.y,this.m[1]*=t.x,this.m[5]*=t.y,this.m[2]*=t.x,this.m[6]*=t.y,this.m[3]*=t.x,this.m[7]*=t.y,this}rotate(t){t=Te(-t);let h=Math.cos(t),f=Math.sin(t),y=this.m[0],M=this.m[1],P=this.m[4],q=this.m[5];return this.m[0]=y*h+M*f,this.m[1]=-y*f+M*h,this.m[4]=P*h+q*f,this.m[5]=-P*f+q*h,this}mult(t){let h=[];for(let f=0;f<4;f++)for(let y=0;y<4;y++)h[f*4+y]=this.m[0*4+y]*t.m[f*4+0]+this.m[1*4+y]*t.m[f*4+1]+this.m[2*4+y]*t.m[f*4+2]+this.m[3*4+y]*t.m[f*4+3];return new Oe(h)}multVec2(t){return new E(t.x*this.m[0]+t.y*this.m[4]+this.m[12],t.x*this.m[1]+t.y*this.m[5]+this.m[13])}getTranslation(){return new E(this.m[12],this.m[13])}getScale(){if(this.m[0]!=0||this.m[1]!=0){let t=this.m[0]*this.m[5]-this.m[1]*this.m[4],h=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new E(h,t/h)}else if(this.m[4]!=0||this.m[5]!=0){let t=this.m[0]*this.m[5]-this.m[1]*this.m[4],h=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new E(t/h,h)}else return new E(0,0)}getRotation(){if(this.m[0]!=0||this.m[1]!=0){let t=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return Pt(this.m[1]>0?Math.acos(this.m[0]/t):-Math.acos(this.m[0]/t))}else if(this.m[4]!=0||this.m[5]!=0){let t=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return Pt(Math.PI/2-(this.m[5]>0?Math.acos(-this.m[4]/t):-Math.acos(this.m[4]/t)))}else return 0}getSkew(){if(this.m[0]!=0||this.m[1]!=0){let t=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new E(Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(t*t),0)}else if(this.m[4]!=0||this.m[5]!=0){let t=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new E(0,Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(t*t))}else return new E(0,0)}invert(){let t=[],h=this.m[10]*this.m[15]-this.m[14]*this.m[11],f=this.m[9]*this.m[15]-this.m[13]*this.m[11],y=this.m[9]*this.m[14]-this.m[13]*this.m[10],M=this.m[8]*this.m[15]-this.m[12]*this.m[11],P=this.m[8]*this.m[14]-this.m[12]*this.m[10],q=this.m[8]*this.m[13]-this.m[12]*this.m[9],W=this.m[6]*this.m[15]-this.m[14]*this.m[7],x=this.m[5]*this.m[15]-this.m[13]*this.m[7],Y=this.m[5]*this.m[14]-this.m[13]*this.m[6],c=this.m[4]*this.m[15]-this.m[12]*this.m[7],$=this.m[4]*this.m[14]-this.m[12]*this.m[6],le=this.m[5]*this.m[15]-this.m[13]*this.m[7],he=this.m[4]*this.m[13]-this.m[12]*this.m[5],He=this.m[6]*this.m[11]-this.m[10]*this.m[7],ge=this.m[5]*this.m[11]-this.m[9]*this.m[7],k=this.m[5]*this.m[10]-this.m[9]*this.m[6],ze=this.m[4]*this.m[11]-this.m[8]*this.m[7],Fe=this.m[4]*this.m[10]-this.m[8]*this.m[6],v=this.m[4]*this.m[9]-this.m[8]*this.m[5];t[0]=this.m[5]*h-this.m[6]*f+this.m[7]*y,t[4]=-(this.m[4]*h-this.m[6]*M+this.m[7]*P),t[8]=this.m[4]*f-this.m[5]*M+this.m[7]*q,t[12]=-(this.m[4]*y-this.m[5]*P+this.m[6]*q),t[1]=-(this.m[1]*h-this.m[2]*f+this.m[3]*y),t[5]=this.m[0]*h-this.m[2]*M+this.m[3]*P,t[9]=-(this.m[0]*f-this.m[1]*M+this.m[3]*q),t[13]=this.m[0]*y-this.m[1]*P+this.m[2]*q,t[2]=this.m[1]*W-this.m[2]*x+this.m[3]*Y,t[6]=-(this.m[0]*W-this.m[2]*c+this.m[3]*$),t[10]=this.m[0]*le-this.m[1]*c+this.m[3]*he,t[14]=-(this.m[0]*Y-this.m[1]*$+this.m[2]*he),t[3]=-(this.m[1]*He-this.m[2]*ge+this.m[3]*k),t[7]=this.m[0]*He-this.m[2]*ze+this.m[3]*Fe,t[11]=-(this.m[0]*ge-this.m[1]*ze+this.m[3]*v),t[15]=this.m[0]*k-this.m[1]*Fe+this.m[2]*v;let oe=this.m[0]*t[0]+this.m[1]*t[4]+this.m[2]*t[8]+this.m[3]*t[12];for(let we=0;we<4;we++)for(let ee=0;ee<4;ee++)t[we*4+ee]*=1/oe;return new Oe(t)}clone(){return new Oe([...this.m])}toString(){return this.m.toString()}};function ai(n,t,h,f=y=>-Math.cos(y)){return n+(f(h)+1)/2*(t-n)}a(ai,"wave");var to=1103515245,no=12345,Us=2147483648,tr=class{static{a(this,"RNG")}seed;constructor(n){this.seed=n}gen(){return this.seed=(to*this.seed+no)%Us,this.seed/Us}genNumber(n,t){return n+this.gen()*(t-n)}genVec2(n,t){return new E(this.genNumber(n.x,t.x),this.genNumber(n.y,t.y))}genColor(n,t){return new _(this.genNumber(n.r,t.r),this.genNumber(n.g,t.g),this.genNumber(n.b,t.b))}genAny(...n){if(n.length===0)return this.gen();if(n.length===1){if(typeof n[0]=="number")return this.genNumber(0,n[0]);if(n[0]instanceof E)return this.genVec2(B(0,0),n[0]);if(n[0]instanceof _)return this.genColor(Z(0,0,0),n[0])}else if(n.length===2){if(typeof n[0]=="number"&&typeof n[1]=="number")return this.genNumber(n[0],n[1]);if(n[0]instanceof E&&n[1]instanceof E)return this.genVec2(n[0],n[1]);if(n[0]instanceof _&&n[1]instanceof _)return this.genColor(n[0],n[1])}}},li=new tr(Date.now());function nr(n){return n!=null&&(li.seed=n),li.seed}a(nr,"randSeed");function sn(...n){return li.genAny(...n)}a(sn,"rand");function fi(...n){return Math.floor(sn(...n))}a(fi,"randi");function ir(n){return sn()<=n}a(ir,"chance");function sr(n){return n[fi(n.length)]}a(sr,"choose");function rr(n,t){return n.pos.x+n.width>t.pos.x&&n.pos.x<t.pos.x+t.width&&n.pos.y+n.height>t.pos.y&&n.pos.y<t.pos.y+t.height}a(rr,"testRectRect");function or(n,t){if(n.p1.x===n.p2.x&&n.p1.y===n.p2.y||t.p1.x===t.p2.x&&t.p1.y===t.p2.y)return null;let h=(t.p2.y-t.p1.y)*(n.p2.x-n.p1.x)-(t.p2.x-t.p1.x)*(n.p2.y-n.p1.y);if(h===0)return null;let f=((t.p2.x-t.p1.x)*(n.p1.y-t.p1.y)-(t.p2.y-t.p1.y)*(n.p1.x-t.p1.x))/h,y=((n.p2.x-n.p1.x)*(n.p1.y-t.p1.y)-(n.p2.y-n.p1.y)*(n.p1.x-t.p1.x))/h;return f<0||f>1||y<0||y>1?null:f}a(or,"testLineLineT");function Mt(n,t){let h=or(n,t);return h?B(n.p1.x+h*(n.p2.x-n.p1.x),n.p1.y+h*(n.p2.y-n.p1.y)):null}a(Mt,"testLineLine");function ar(n,t){if(rn(n,t.p1)||rn(n,t.p2))return!0;let h=n.points();return!!Mt(t,new Bt(h[0],h[1]))||!!Mt(t,new Bt(h[1],h[2]))||!!Mt(t,new Bt(h[2],h[3]))||!!Mt(t,new Bt(h[3],h[0]))}a(ar,"testRectLine");function rn(n,t){return t.x>n.pos.x&&t.x<n.pos.x+n.width&&t.y>n.pos.y&&t.y<n.pos.y+n.height}a(rn,"testRectPoint");function lr(n,t){let h=t.sub(n.p1),f=n.p2.sub(n.p1);if(Math.abs(h.cross(f))>Number.EPSILON)return!1;let y=h.dot(f)/f.dot(f);return y>=0&&y<=1}a(lr,"testLinePoint");function mi(n,t){let h=n.p2.sub(n.p1),f=h.dot(h),y=n.p1.sub(t.center),M=2*h.dot(y),P=y.dot(y)-t.radius*t.radius,q=M*M-4*f*P;if(f<=Number.EPSILON||q<0)return!1;if(q==0){let W=-M/(2*f);if(W>=0&&W<=1)return!0}else{let W=(-M+Math.sqrt(q))/(2*f),x=(-M-Math.sqrt(q))/(2*f);if(W>=0&&W<=1||x>=0&&x<=1)return!0}return gi(t,n.p1)}a(mi,"testLineCircle");function gi(n,t){return n.center.sdist(t)<n.radius*n.radius}a(gi,"testCirclePoint");function hr(n,t){let h=t.pts[t.pts.length-1];for(let f of t.pts){if(mi(new Bt(h,f),n))return!0;h=f}return gi(n,t.pts[0])?!0:wi(t,n.center)}a(hr,"testCirclePolygon");function wi(n,t){let h=!1,f=n.pts;for(let y=0,M=f.length-1;y<f.length;M=y++)f[y].y>t.y!=f[M].y>t.y&&t.x<(f[M].x-f[y].x)*(t.y-f[y].y)/(f[M].y-f[y].y)+f[y].x&&(h=!h);return h}a(wi,"testPolygonPoint");var Bt=class hi{static{a(this,"Line")}p1;p2;constructor(t,h){this.p1=t.clone(),this.p2=h.clone()}transform(t){return new hi(t.multVec2(this.p1),t.multVec2(this.p2))}bbox(){return Ve.fromPoints(this.p1,this.p2)}area(){return this.p1.dist(this.p2)}clone(){return new hi(this.p1,this.p2)}},Ve=class ui{static{a(this,"Rect")}pos;width;height;constructor(t,h,f){this.pos=t.clone(),this.width=h,this.height=f}static fromPoints(t,h){return new ui(t.clone(),h.x-t.x,h.y-t.y)}center(){return new E(this.pos.x+this.width/2,this.pos.y+this.height/2)}points(){return[this.pos,this.pos.add(this.width,0),this.pos.add(this.width,this.height),this.pos.add(0,this.height)]}transform(t){return new xn(this.points().map(h=>t.multVec2(h)))}bbox(){return this.clone()}area(){return this.width*this.height}clone(){return new ui(this.pos.clone(),this.width,this.height)}distToPoint(t){return Math.sqrt(this.sdistToPoint(t))}sdistToPoint(t){let h=this.pos,f=this.pos.add(this.width,this.height),y=Math.max(h.x-t.x,0,t.x-f.x),M=Math.max(h.y-t.y,0,t.y-f.y);return y*y+M*M}},Ls=class ur{static{a(this,"Circle")}center;radius;constructor(t,h){this.center=t.clone(),this.radius=h}transform(t){return new io(this.center,this.radius,this.radius).transform(t)}bbox(){return Ve.fromPoints(this.center.sub(B(this.radius)),this.center.add(B(this.radius)))}area(){return this.radius*this.radius*Math.PI}clone(){return new ur(this.center,this.radius)}},io=class di{static{a(this,"Ellipse")}center;radiusX;radiusY;constructor(t,h,f){this.center=t.clone(),this.radiusX=h,this.radiusY=f}transform(t){return new di(t.multVec2(this.center),t.m[0]*this.radiusX,t.m[5]*this.radiusY)}bbox(){return Ve.fromPoints(this.center.sub(B(this.radiusX,this.radiusY)),this.center.add(B(this.radiusX,this.radiusY)))}area(){return this.radiusX*this.radiusY*Math.PI}clone(){return new di(this.center,this.radiusX,this.radiusY)}},xn=class ci{static{a(this,"Polygon")}pts;constructor(t){if(t.length<3)throw new Error("Polygons should have at least 3 vertices");this.pts=t}transform(t){return new ci(this.pts.map(h=>t.multVec2(h)))}bbox(){let t=B(Number.MAX_VALUE),h=B(-Number.MAX_VALUE);for(let f of this.pts)t.x=Math.min(t.x,f.x),h.x=Math.max(h.x,f.x),t.y=Math.min(t.y,f.y),h.y=Math.max(h.y,f.y);return Ve.fromPoints(t,h)}area(){let t=0,h=this.pts.length;for(let f=0;f<h;f++){let y=this.pts[f],M=this.pts[(f+1)%h];t+=y.x*M.y*.5,t-=M.x*y.y*.5}return Math.abs(t)}clone(){return new ci(this.pts.map(t=>t.clone()))}};function dr(n,t){let h=Number.MAX_VALUE,f=B(0);for(let y of[n,t])for(let M=0;M<y.pts.length;M++){let P=y.pts[M],q=y.pts[(M+1)%y.pts.length].sub(P).normal().unit(),W=Number.MAX_VALUE,x=-Number.MAX_VALUE;for(let le=0;le<n.pts.length;le++){let he=n.pts[le].dot(q);W=Math.min(W,he),x=Math.max(x,he)}let Y=Number.MAX_VALUE,c=-Number.MAX_VALUE;for(let le=0;le<t.pts.length;le++){let he=t.pts[le].dot(q);Y=Math.min(Y,he),c=Math.max(c,he)}let $=Math.min(x,c)-Math.max(W,Y);if($<0)return null;if($<Math.abs(h)){let le=c-W,he=Y-x;h=Math.abs(le)<Math.abs(he)?le:he,f=q.scale(h)}}return f}a(dr,"sat");var cr=class extends Map{static{a(this,"IDList")}lastID;constructor(...n){super(...n),this.lastID=0}push(n){let t=this.lastID;return this.set(t,n),this.lastID++,t}pushd(n){let t=this.push(n);return()=>this.delete(t)}},Rt=class pr{static{a(this,"EventController")}paused=!1;cancel;constructor(t){this.cancel=t}static join(t){let h=new pr(()=>t.forEach(f=>f.cancel()));return Object.defineProperty(h,"paused",{get:()=>t[0].paused,set:f=>t.forEach(y=>y.paused=f)}),h.paused=!1,h}},Be=class{static{a(this,"Event")}handlers=new cr;add(n){let t=this.handlers.pushd((...f)=>{h.paused||n(...f)}),h=new Rt(t);return h}addOnce(n){let t=this.add((...h)=>{t.cancel(),n(...h)});return t}next(){return new Promise(n=>this.addOnce(n))}trigger(...n){this.handlers.forEach(t=>t(...n))}numListeners(){return this.handlers.size}clear(){this.handlers.clear()}},nn=class{static{a(this,"EventHandler")}handlers={};on(n,t){return this.handlers[n]||(this.handlers[n]=new Be),this.handlers[n].add(t)}onOnce(n,t){let h=this.on(n,(...f)=>{h.cancel(),t(...f)});return h}next(n){return new Promise(t=>{this.onOnce(n,(...h)=>t(h[0]))})}trigger(n,...t){this.handlers[n]&&this.handlers[n].trigger(...t)}remove(n){delete this.handlers[n]}clear(){this.handlers={}}numListeners(n){return this.handlers[n]?.numListeners()??0}};function Ai(n,t){let h=typeof n,f=typeof t;if(h!==f)return!1;if(h==="object"&&f==="object"&&n!==null&&t!==null){let y=Object.keys(n),M=Object.keys(t);if(y.length!==M.length)return!1;for(let P of y){let q=n[P],W=t[P];if(!(typeof q=="function"&&typeof W=="function")&&!Ai(q,W))return!1}return!0}return n===t}a(Ai,"deepEq");function fr(n){let t=window.atob(n),h=t.length,f=new Uint8Array(h);for(let y=0;y<h;y++)f[y]=t.charCodeAt(y);return f.buffer}a(fr,"base64ToArrayBuffer");function mr(n){return fr(n.split(",")[1])}a(mr,"dataURLToArrayBuffer");function Rn(n,t){let h=document.createElement("a");h.href=t,h.download=n,h.click()}a(Rn,"download");function vi(n,t){Rn(n,"data:text/plain;charset=utf-8,"+t)}a(vi,"downloadText");function gr(n,t){vi(n,JSON.stringify(t))}a(gr,"downloadJSON");function pi(n,t){let h=URL.createObjectURL(t);Rn(n,h),URL.revokeObjectURL(h)}a(pi,"downloadBlob");var Ns=a(n=>n.match(/^data:\w+\/\w+;base64,.+/),"isDataURL"),so=a(n=>n.split(".").pop(),"getExt"),ro=(()=>{let n=0;return()=>n++})(),oo=class{static{a(this,"BinaryHeap")}_items;_compareFn;constructor(n=(t,h)=>t<h){this._compareFn=n,this._items=[]}insert(n){this._items.push(n),this.moveUp(this._items.length-1)}remove(){if(this._items.length===0)return null;let n=this._items[0],t=this._items.pop();return this._items.length!==0&&(this._items[0]=t,this.moveDown(0)),n}clear(){this._items.splice(0,this._items.length)}moveUp(n){for(;n>0;){let t=Math.floor((n-1)/2);if(!this._compareFn(this._items[n],this._items[t])&&this._items[n]>=this._items[t])break;this.swap(n,t),n=t}}moveDown(n){for(;n<Math.floor(this._items.length/2);){let t=2*n+1;if(t<this._items.length-1&&!this._compareFn(this._items[t],this._items[t+1])&&++t,this._compareFn(this._items[n],this._items[t]))break;this.swap(n,t),n=t}}swap(n,t){[this._items[n],this._items[t]]=[this._items[t],this._items[n]]}get length(){return this._items.length}},Os={"Joy-Con L+R (STANDARD GAMEPAD Vendor: 057e Product: 200e)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},"Joy-Con (L) (STANDARD GAMEPAD Vendor: 057e Product: 2006)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"select",10:"lstick",16:"start"},sticks:{left:{x:0,y:1}}},"Joy-Con (R) (STANDARD GAMEPAD Vendor: 057e Product: 2007)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"start",10:"lstick",16:"select"},sticks:{left:{x:0,y:1}}},"Pro Controller (STANDARD GAMEPAD Vendor: 057e Product: 2009)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},default:{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}}},bn=class{static{a(this,"ButtonState")}pressed=new Set([]);pressedRepeat=new Set([]);released=new Set([]);down=new Set([]);update(){this.pressed.clear(),this.released.clear(),this.pressedRepeat.clear()}press(n){this.pressed.add(n),this.pressedRepeat.add(n),this.down.add(n)}pressRepeat(n){this.pressedRepeat.add(n)}release(n){this.down.delete(n),this.pressed.delete(n),this.released.add(n)}},ao=class{static{a(this,"GamepadState")}buttonState=new bn;stickState=new Map},lo=class{static{a(this,"FPSCounter")}dts=[];timer=0;fps=0;tick(n){this.dts.push(n),this.timer+=n,this.timer>=1&&(this.timer=0,this.fps=Math.round(1/(this.dts.reduce((t,h)=>t+h)/this.dts.length)),this.dts=[])}},ho=a(n=>{if(!n.canvas)throw new Error("Please provide a canvas");let t={canvas:n.canvas,loopID:null,stopped:!1,dt:0,time:0,realTime:0,fpsCounter:new lo,timeScale:1,skipTime:!1,numFrames:0,mousePos:new E(0),mouseDeltaPos:new E(0),keyState:new bn,mouseState:new bn,mergedGamepadState:new ao,gamepadStates:new Map,gamepads:[],charInputted:[],isMouseMoved:!1,lastWidth:n.canvas.offsetWidth,lastHeight:n.canvas.offsetHeight,events:new nn};function h(){return t.canvas}a(h,"canvas");function f(){return t.dt*t.timeScale}a(f,"dt");function y(){return t.time}a(y,"time");function M(){return t.fpsCounter.fps}a(M,"fps");function P(){return t.numFrames}a(P,"numFrames");function q(){return t.canvas.toDataURL()}a(q,"screenshot");function W(p){t.canvas.style.cursor=p}a(W,"setCursor");function x(){return t.canvas.style.cursor}a(x,"getCursor");function Y(p){if(p)try{let V=t.canvas.requestPointerLock();V.catch&&V.catch(S=>console.error(S))}catch(V){console.error(V)}else document.exitPointerLock()}a(Y,"setCursorLocked");function c(){return!!document.pointerLockElement}a(c,"isCursorLocked");function $(p){p.requestFullscreen?p.requestFullscreen():p.webkitRequestFullscreen&&p.webkitRequestFullscreen()}a($,"enterFullscreen");function le(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullScreen&&document.webkitExitFullScreen()}a(le,"exitFullscreen");function he(){return document.fullscreenElement||document.webkitFullscreenElement}a(he,"getFullscreenElement");function He(p=!0){p?$(t.canvas):le()}a(He,"setFullscreen");function ge(){return!!he()}a(ge,"isFullscreen");function k(){t.stopped=!0;for(let p in ie)t.canvas.removeEventListener(p,ie[p]);for(let p in qe)document.removeEventListener(p,qe[p]);for(let p in Me)window.removeEventListener(p,Me[p]);Yt.disconnect()}a(k,"quit");function ze(p){t.loopID!==null&&cancelAnimationFrame(t.loopID);let V=0,S=a(j=>{if(t.stopped)return;if(document.visibilityState!=="visible"){t.loopID=requestAnimationFrame(S);return}let O=j/1e3,te=O-t.realTime,de=n.maxFPS?1/n.maxFPS:0;t.realTime=O,V+=te,V>de&&(t.skipTime||(t.dt=V,t.time+=f(),t.fpsCounter.tick(t.dt)),V=0,t.skipTime=!1,t.numFrames++,Kt(),p(),gt()),t.loopID=requestAnimationFrame(S)},"frame");S(0)}a(ze,"run");function Fe(){return"ontouchstart"in window||navigator.maxTouchPoints>0}a(Fe,"isTouchscreen");function v(){return t.mousePos.clone()}a(v,"mousePos");function oe(){return t.mouseDeltaPos.clone()}a(oe,"mouseDeltaPos");function we(p="left"){return t.mouseState.pressed.has(p)}a(we,"isMousePressed");function ee(p="left"){return t.mouseState.down.has(p)}a(ee,"isMouseDown");function ue(p="left"){return t.mouseState.released.has(p)}a(ue,"isMouseReleased");function De(){return t.isMouseMoved}a(De,"isMouseMoved");function K(p){return p===void 0?t.keyState.pressed.size>0:t.keyState.pressed.has(p)}a(K,"isKeyPressed");function T(p){return p===void 0?t.keyState.pressedRepeat.size>0:t.keyState.pressedRepeat.has(p)}a(T,"isKeyPressedRepeat");function rt(p){return p===void 0?t.keyState.down.size>0:t.keyState.down.has(p)}a(rt,"isKeyDown");function Re(p){return p===void 0?t.keyState.released.size>0:t.keyState.released.has(p)}a(Re,"isKeyReleased");function Ft(p){return p===void 0?t.mergedGamepadState.buttonState.pressed.size>0:t.mergedGamepadState.buttonState.pressed.has(p)}a(Ft,"isGamepadButtonPressed");function Qe(p){return p===void 0?t.mergedGamepadState.buttonState.down.size>0:t.mergedGamepadState.buttonState.down.has(p)}a(Qe,"isGamepadButtonDown");function je(p){return p===void 0?t.mergedGamepadState.buttonState.released.size>0:t.mergedGamepadState.buttonState.released.has(p)}a(je,"isGamepadButtonReleased");function Dt(p){return t.events.on("resize",p)}a(Dt,"onResize");let an=a((p,V)=>{if(typeof p=="function")return t.events.on("keyDown",p);if(typeof p=="string"&&typeof V=="function")return t.events.on("keyDown",S=>S===p&&V(p))},"onKeyDown"),Je=a((p,V)=>{if(typeof p=="function")return t.events.on("keyPress",p);if(typeof p=="string"&&typeof V=="function")return t.events.on("keyPress",S=>S===p&&V(p))},"onKeyPress"),ln=a((p,V)=>{if(typeof p=="function")return t.events.on("keyPressRepeat",p);if(typeof p=="string"&&typeof V=="function")return t.events.on("keyPressRepeat",S=>S===p&&V(p))},"onKeyPressRepeat"),ot=a((p,V)=>{if(typeof p=="function")return t.events.on("keyRelease",p);if(typeof p=="string"&&typeof V=="function")return t.events.on("keyRelease",S=>S===p&&V(p))},"onKeyRelease");function It(p,V){return typeof p=="function"?t.events.on("mouseDown",S=>p(S)):t.events.on("mouseDown",S=>S===p&&V(S))}a(It,"onMouseDown");function Ut(p,V){return typeof p=="function"?t.events.on("mousePress",S=>p(S)):t.events.on("mousePress",S=>S===p&&V(S))}a(Ut,"onMousePress");function at(p,V){return typeof p=="function"?t.events.on("mouseRelease",S=>p(S)):t.events.on("mouseRelease",S=>S===p&&V(S))}a(at,"onMouseRelease");function lt(p){return t.events.on("mouseMove",()=>p(v(),oe()))}a(lt,"onMouseMove");function ht(p){return t.events.on("charInput",p)}a(ht,"onCharInput");function Ie(p){return t.events.on("touchStart",p)}a(Ie,"onTouchStart");function Lt(p){return t.events.on("touchMove",p)}a(Lt,"onTouchMove");function Nt(p){return t.events.on("touchEnd",p)}a(Nt,"onTouchEnd");function Ot(p){return t.events.on("scroll",p)}a(Ot,"onScroll");function Gt(p){return t.events.on("hide",p)}a(Gt,"onHide");function Ht(p){return t.events.on("show",p)}a(Ht,"onShow");function jt(p,V){if(typeof p=="function")return t.events.on("gamepadButtonDown",p);if(typeof p=="string"&&typeof V=="function")return t.events.on("gamepadButtonDown",S=>S===p&&V(p))}a(jt,"onGamepadButtonDown");function ut(p,V){if(typeof p=="function")return t.events.on("gamepadButtonPress",p);if(typeof p=="string"&&typeof V=="function")return t.events.on("gamepadButtonPress",S=>S===p&&V(p))}a(ut,"onGamepadButtonPress");function dt(p,V){if(typeof p=="function")return t.events.on("gamepadButtonRelease",p);if(typeof p=="string"&&typeof V=="function")return t.events.on("gamepadButtonRelease",S=>S===p&&V(p))}a(dt,"onGamepadButtonRelease");function ct(p,V){return t.events.on("gamepadStick",(S,j)=>S===p&&V(j))}a(ct,"onGamepadStick");function pt(p){t.events.on("gamepadConnect",p)}a(pt,"onGamepadConnect");function ft(p){t.events.on("gamepadDisconnect",p)}a(ft,"onGamepadDisconnect");function qt(p){return t.mergedGamepadState.stickState.get(p)||new E(0)}a(qt,"getGamepadStick");function Ze(){return[...t.charInputted]}a(Ze,"charInputted");function mt(){return[...t.gamepads]}a(mt,"getGamepads");function Kt(){t.events.trigger("input"),t.keyState.down.forEach(p=>t.events.trigger("keyDown",p)),t.mouseState.down.forEach(p=>t.events.trigger("mouseDown",p)),vt()}a(Kt,"processInput");function gt(){t.keyState.update(),t.mouseState.update(),t.mergedGamepadState.buttonState.update(),t.mergedGamepadState.stickState.forEach((p,V)=>{t.mergedGamepadState.stickState.set(V,new E(0))}),t.charInputted=[],t.isMouseMoved=!1,t.gamepadStates.forEach(p=>{p.buttonState.update(),p.stickState.forEach((V,S)=>{p.stickState.set(S,new E(0))})})}a(gt,"resetInput");function wt(p){let V={index:p.index,isPressed:S=>t.gamepadStates.get(p.index).buttonState.pressed.has(S),isDown:S=>t.gamepadStates.get(p.index).buttonState.down.has(S),isReleased:S=>t.gamepadStates.get(p.index).buttonState.released.has(S),getStick:S=>t.gamepadStates.get(p.index).stickState.get(S)};return t.gamepads.push(V),t.gamepadStates.set(p.index,{buttonState:new bn,stickState:new Map([["left",new E(0)],["right",new E(0)]])}),V}a(wt,"registerGamepad");function At(p){t.gamepads=t.gamepads.filter(V=>V.index!==p.index),t.gamepadStates.delete(p.index)}a(At,"removeGamepad");function vt(){for(let p of navigator.getGamepads())p&&!t.gamepadStates.has(p.index)&&wt(p);for(let p of t.gamepads){let V=navigator.getGamepads()[p.index],S=(n.gamepads??{})[V.id]??Os[V.id]??Os.default,j=t.gamepadStates.get(p.index);for(let O=0;O<V.buttons.length;O++)V.buttons[O].pressed?(j.buttonState.down.has(S.buttons[O])||(t.mergedGamepadState.buttonState.press(S.buttons[O]),j.buttonState.press(S.buttons[O]),t.events.trigger("gamepadButtonPress",S.buttons[O])),t.events.trigger("gamepadButtonDown",S.buttons[O])):j.buttonState.down.has(S.buttons[O])&&(t.mergedGamepadState.buttonState.release(S.buttons[O]),j.buttonState.release(S.buttons[O]),t.events.trigger("gamepadButtonRelease",S.buttons[O]));for(let O in S.sticks){let te=S.sticks[O],de=new E(V.axes[te.x],V.axes[te.y]);j.stickState.set(O,de),t.mergedGamepadState.stickState.set(O,de),t.events.trigger("gamepadStick",O,de)}}}a(vt,"processGamepad");let ie={},qe={},Me={},be=n.pixelDensity||window.devicePixelRatio||1;ie.mousemove=p=>{let V=new E(p.offsetX,p.offsetY),S=new E(p.movementX,p.movementY);if(ge()){let j=t.canvas.width/be,O=t.canvas.height/be,te=window.innerWidth,de=window.innerHeight,_e=te/de,un=j/O;if(_e>un){let ye=de/O,ce=(te-j*ye)/2;V.x=Xe(p.offsetX-ce,0,j*ye,0,j),V.y=Xe(p.offsetY,0,O*ye,0,O)}else{let ye=te/j,ce=(de-O*ye)/2;V.x=Xe(p.offsetX,0,j*ye,0,j),V.y=Xe(p.offsetY-ce,0,O*ye,0,O)}}t.events.onOnce("input",()=>{t.isMouseMoved=!0,t.mousePos=V,t.mouseDeltaPos=S,t.events.trigger("mouseMove")})};let Vt=["left","middle","right","back","forward"];ie.mousedown=p=>{t.events.onOnce("input",()=>{let V=Vt[p.button];V&&(t.mouseState.press(V),t.events.trigger("mousePress",V))})},ie.mouseup=p=>{t.events.onOnce("input",()=>{let V=Vt[p.button];V&&(t.mouseState.release(V),t.events.trigger("mouseRelease",V))})};let hn=new Set([" ","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Tab"]),yt={ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",ArrowDown:"down"," ":"space"};ie.keydown=p=>{hn.has(p.key)&&p.preventDefault(),t.events.onOnce("input",()=>{let V=yt[p.key]||p.key.toLowerCase();V.length===1?(t.events.trigger("charInput",V),t.charInputted.push(V)):V==="space"&&(t.events.trigger("charInput"," "),t.charInputted.push(" ")),p.repeat?(t.keyState.pressRepeat(V),t.events.trigger("keyPressRepeat",V)):(t.keyState.press(V),t.events.trigger("keyPressRepeat",V),t.events.trigger("keyPress",V))})},ie.keyup=p=>{t.events.onOnce("input",()=>{let V=yt[p.key]||p.key.toLowerCase();t.keyState.release(V),t.events.trigger("keyRelease",V)})},ie.touchstart=p=>{p.preventDefault(),t.events.onOnce("input",()=>{let V=[...p.changedTouches],S=t.canvas.getBoundingClientRect();n.touchToMouse!==!1&&(t.mousePos=new E(V[0].clientX-S.x,V[0].clientY-S.y),t.mouseState.press("left"),t.events.trigger("mousePress","left")),V.forEach(j=>{t.events.trigger("touchStart",new E(j.clientX-S.x,j.clientY-S.y),j)})})},ie.touchmove=p=>{p.preventDefault(),t.events.onOnce("input",()=>{let V=[...p.changedTouches],S=t.canvas.getBoundingClientRect();n.touchToMouse!==!1&&(t.mousePos=new E(V[0].clientX-S.x,V[0].clientY-S.y),t.events.trigger("mouseMove")),V.forEach(j=>{t.events.trigger("touchMove",new E(j.clientX-S.x,j.clientY-S.y),j)})})},ie.touchend=p=>{t.events.onOnce("input",()=>{let V=[...p.changedTouches],S=t.canvas.getBoundingClientRect();n.touchToMouse!==!1&&(t.mousePos=new E(V[0].clientX-S.x,V[0].clientY-S.y),t.mouseState.release("left"),t.events.trigger("mouseRelease","left")),V.forEach(j=>{t.events.trigger("touchEnd",new E(j.clientX-S.x,j.clientY-S.y),j)})})},ie.touchcancel=p=>{t.events.onOnce("input",()=>{let V=[...p.changedTouches],S=t.canvas.getBoundingClientRect();n.touchToMouse!==!1&&(t.mousePos=new E(V[0].clientX-S.x,V[0].clientY-S.y),t.mouseState.release("left"),t.events.trigger("mouseRelease","left")),V.forEach(j=>{t.events.trigger("touchEnd",new E(j.clientX-S.x,j.clientY-S.y),j)})})},ie.wheel=p=>{p.preventDefault(),t.events.onOnce("input",()=>{t.events.trigger("scroll",new E(p.deltaX,p.deltaY))})},ie.contextmenu=p=>p.preventDefault(),qe.visibilitychange=()=>{document.visibilityState==="visible"?(t.skipTime=!0,t.events.trigger("show")):t.events.trigger("hide")},Me.gamepadconnected=p=>{let V=wt(p.gamepad);t.events.onOnce("input",()=>{t.events.trigger("gamepadConnect",V)})},Me.gamepaddisconnected=p=>{let V=mt().filter(S=>S.index===p.gamepad.index)[0];At(p.gamepad),t.events.onOnce("input",()=>{t.events.trigger("gamepadDisconnect",V)})};for(let p in ie)t.canvas.addEventListener(p,ie[p]);for(let p in qe)document.addEventListener(p,qe[p]);for(let p in Me)window.addEventListener(p,Me[p]);let Yt=new ResizeObserver(p=>{for(let V of p)if(V.target===t.canvas){if(t.lastWidth===t.canvas.offsetWidth&&t.lastHeight===t.canvas.offsetHeight)return;t.lastWidth=t.canvas.offsetWidth,t.lastHeight=t.canvas.offsetHeight,t.events.onOnce("input",()=>{t.events.trigger("resize")})}});return Yt.observe(t.canvas),{dt:f,time:y,run:ze,canvas:h,fps:M,numFrames:P,quit:k,setFullscreen:He,isFullscreen:ge,setCursor:W,screenshot:q,getGamepads:mt,getCursor:x,setCursorLocked:Y,isCursorLocked:c,isTouchscreen:Fe,mousePos:v,mouseDeltaPos:oe,isKeyDown:rt,isKeyPressed:K,isKeyPressedRepeat:T,isKeyReleased:Re,isMouseDown:ee,isMousePressed:we,isMouseReleased:ue,isMouseMoved:De,isGamepadButtonPressed:Ft,isGamepadButtonDown:Qe,isGamepadButtonReleased:je,getGamepadStick:qt,charInputted:Ze,onResize:Dt,onKeyDown:an,onKeyPress:Je,onKeyPressRepeat:ln,onKeyRelease:ot,onMouseDown:It,onMousePress:Ut,onMouseRelease:at,onMouseMove:lt,onCharInput:ht,onTouchStart:Ie,onTouchMove:Lt,onTouchEnd:Nt,onScroll:Ot,onHide:Gt,onShow:Ht,onGamepadButtonDown:jt,onGamepadButtonPress:ut,onGamepadButtonRelease:dt,onGamepadStick:ct,onGamepadConnect:pt,onGamepadDisconnect:ft,events:t.events}},"default"),vn=2.5949095,Gs=1.70158+1,Hs=2*Math.PI/3,js=2*Math.PI/4.5,En={linear:n=>n,easeInSine:n=>1-Math.cos(n*Math.PI/2),easeOutSine:n=>Math.sin(n*Math.PI/2),easeInOutSine:n=>-(Math.cos(Math.PI*n)-1)/2,easeInQuad:n=>n*n,easeOutQuad:n=>1-(1-n)*(1-n),easeInOutQuad:n=>n<.5?2*n*n:1-Math.pow(-2*n+2,2)/2,easeInCubic:n=>n*n*n,easeOutCubic:n=>1-Math.pow(1-n,3),easeInOutCubic:n=>n<.5?4*n*n*n:1-Math.pow(-2*n+2,3)/2,easeInQuart:n=>n*n*n*n,easeOutQuart:n=>1-Math.pow(1-n,4),easeInOutQuart:n=>n<.5?8*n*n*n*n:1-Math.pow(-2*n+2,4)/2,easeInQuint:n=>n*n*n*n*n,easeOutQuint:n=>1-Math.pow(1-n,5),easeInOutQuint:n=>n<.5?16*n*n*n*n*n:1-Math.pow(-2*n+2,5)/2,easeInExpo:n=>n===0?0:Math.pow(2,10*n-10),easeOutExpo:n=>n===1?1:1-Math.pow(2,-10*n),easeInOutExpo:n=>n===0?0:n===1?1:n<.5?Math.pow(2,20*n-10)/2:(2-Math.pow(2,-20*n+10))/2,easeInCirc:n=>1-Math.sqrt(1-Math.pow(n,2)),easeOutCirc:n=>Math.sqrt(1-Math.pow(n-1,2)),easeInOutCirc:n=>n<.5?(1-Math.sqrt(1-Math.pow(2*n,2)))/2:(Math.sqrt(1-Math.pow(-2*n+2,2))+1)/2,easeInBack:n=>Gs*n*n*n-1.70158*n*n,easeOutBack:n=>1+Gs*Math.pow(n-1,3)+1.70158*Math.pow(n-1,2),easeInOutBack:n=>n<.5?Math.pow(2*n,2)*((vn+1)*2*n-vn)/2:(Math.pow(2*n-2,2)*((vn+1)*(n*2-2)+vn)+2)/2,easeInElastic:n=>n===0?0:n===1?1:-Math.pow(2,10*n-10)*Math.sin((n*10-10.75)*Hs),easeOutElastic:n=>n===0?0:n===1?1:Math.pow(2,-10*n)*Math.sin((n*10-.75)*Hs)+1,easeInOutElastic:n=>n===0?0:n===1?1:n<.5?-(Math.pow(2,20*n-10)*Math.sin((20*n-11.125)*js))/2:Math.pow(2,-20*n+10)*Math.sin((20*n-11.125)*js)/2+1,easeInBounce:n=>1-En.easeOutBounce(1-n),easeOutBounce:n=>n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375,easeInOutBounce:n=>n<.5?(1-En.easeOutBounce(1-2*n))/2:(1+En.easeOutBounce(2*n-1))/2},tn=En,uo=class{static{a(this,"Timer")}time;action;finished=!1;paused=!1;constructor(n,t){this.time=n,this.action=t}tick(n){return this.finished||this.paused?!1:(this.time-=n,this.time<=0?(this.action(),this.finished=!0,this.time=0,!0):!1)}reset(n){this.time=n,this.finished=!1}},co="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAA1CAYAAADyMeOEAAAAAXNSR0IArs4c6QAAAoVJREFUaIHdm7txwkAQhheGAqACiCHzOKQDQrqgILpwSAeEDBnEUAF0gCMxZ7G72qce/mec2Lpf9+3unaS78wgSNZ8uX5729+d1FNWXUuGmXlBOUUEIMckEpeQJgBu6C+BSFngztBR2vd+ovY+7g+p6LbgaWgJrAeUkDYIUXgXdBBwNi6kpABJwMTQH3AZsXRR8GHTfgEth8E3gjdAUcNewpbTgY85sCMCUuOokozE0YM0YRzM9NGAAXd8+omAF5h4lnmBRvpSnZHyLoLEbaN+aKB9KWv/KWw0tAbbANnlG+UvB2dm77NxxdwgBpjrF/d7rW9cbmpvio2A5z8iAYpVU8pGZlo6/2+MSco2lHfd3rv9jAP038e1xef9o2mjvYb2OqpqKE81028/jeietlSEVO5FRWsxWsJit1G3aFpW8iWe5RwpiCZAk25QvV6nz6fIlynRGuTd5WqpJ4guAlDfVKBK87hXljflgv1ON6fV+4+5gVlA17SfeG0heKqQd4l4jI/wrmaA9N9R4ar+wpHJDZyrrfcH0nB66PqAzPi76pn+faSyJk/vzOorYhGurQrzj/P68jtBMawHaHBIR9xoD5O34dy0qQOSYHvqExq2TpT2nf76+w7y251OYF0CRaU+J920TwLUa6inx6OxE6g80lu2ux7Y2eJLF/rCXE6zEPdnenk9o+4ih9AEdnW2q81HXl5LuU6OTl2fXUhqganbXAGq3g6jJOWV/OnoesO6YqqEB/GdNsjf7uHtwj2DzmRNpp7iOZfm6D9oAxB6Yi1gC4oIYeo4MIPdopEQRB+cAko5J1tW386HpB2Kz1eop4Epdwls/kgZ1sh8gZsEjdcWkr//D8Qu3Z3l5Nl1NtAAAAABJRU5ErkJggg==",po=$r("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L5QNSqT5iiySS9Ja2SV//5ME0ak//+4KgAAABgQBAADAMDgYCAEgCteQ0fZH6+ICXA357+MPfhR/+ywRf/U///LVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5JknQAFoWhGLm5gBClBmT3GiAAAAAGkHAAAIAAANIOAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"),fo="data:image/png;base64,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",mo="data:image/png;base64,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",go="3000.1.11",qs=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",Vn="topleft",Ks=64,wo="monospace",yn="monospace",Ao=36,Ys=64,Ws=256,Xs=2048,zs=2048,Qs=2048,Js=2048,Zs=.1,vo=64,ii="nearest",Vo=8,yo=4,wr=[{name:"a_pos",size:2},{name:"a_uv",size:2},{name:"a_color",size:4}],Sn=wr.reduce((n,t)=>n+t.size,0),Ar=2048,_s=Ar*4*Sn,$s=Ar*6,xo=`
attribute vec2 a_pos;
attribute vec2 a_uv;
attribute vec4 a_color;

varying vec2 v_pos;
varying vec2 v_uv;
varying vec4 v_color;

vec4 def_vert() {
	return vec4(a_pos, 0.0, 1.0);
}

{{user}}

void main() {
	vec4 pos = vert(a_pos, a_uv, a_color);
	v_pos = a_pos;
	v_uv = a_uv;
	v_color = a_color;
	gl_Position = pos;
}
`,bo=`
precision mediump float;

varying vec2 v_pos;
varying vec2 v_uv;
varying vec4 v_color;

uniform sampler2D u_tex;

vec4 def_frag() {
	return v_color * texture2D(u_tex, v_uv);
}

{{user}}

void main() {
	gl_FragColor = frag(v_pos, v_uv, v_color, u_tex);
	if (gl_FragColor.a == 0.0) {
		discard;
	}
}
`,si=`
vec4 vert(vec2 pos, vec2 uv, vec4 color) {
	return def_vert();
}
`,ri=`
vec4 frag(vec2 pos, vec2 uv, vec4 color, sampler2D tex) {
	return def_frag();
}
`,Eo=new Set(["id","require"]),So=new Set(["add","update","draw","destroy","inspect","drawInspect"]);function it(n){switch(n){case"topleft":return new E(-1,-1);case"top":return new E(0,-1);case"topright":return new E(1,-1);case"left":return new E(-1,0);case"center":return new E(0,0);case"right":return new E(1,0);case"botleft":return new E(-1,1);case"bot":return new E(0,1);case"botright":return new E(1,1);default:return n}}a(it,"anchorPt");function vr(n){switch(n){case"left":return 0;case"center":return .5;case"right":return 1;default:return 0}}a(vr,"alignPt");function Vr(n){return n.createBuffer(1,1,44100)}a(Vr,"createEmptyAudioBuffer");var yr=a((n={})=>{let t=n.root??document.body;t===document.body&&(document.body.style.width="100%",document.body.style.height="100%",document.body.style.margin="0px",document.documentElement.style.width="100%",document.documentElement.style.height="100%");let h=n.canvas??(()=>{let e=document.createElement("canvas");return t.appendChild(e),e})(),f=n.scale??1,y=n.width&&n.height&&!n.stretch&&!n.letterbox;y?(h.width=n.width*f,h.height=n.height*f):(h.width=h.parentElement.offsetWidth,h.height=h.parentElement.offsetHeight);let M=["outline: none","cursor: default"];if(y){let e=h.width,i=h.height;M.push(`width: ${e}px`),M.push(`height: ${i}px`)}else M.push("width: 100%"),M.push("height: 100%");n.crisp&&(M.push("image-rendering: pixelated"),M.push("image-rendering: crisp-edges")),h.style.cssText=M.join(";");let P=n.pixelDensity||window.devicePixelRatio;h.width*=P,h.height*=P,h.tabIndex=0;let q=document.createElement("canvas");q.width=Ws,q.height=Ws;let W=q.getContext("2d",{willReadFrequently:!0}),x=ho({canvas:h,touchToMouse:n.touchToMouse,gamepads:n.gamepads,pixelDensity:n.pixelDensity,maxFPS:n.maxFPS}),Y=[],c=x.canvas().getContext("webgl",{antialias:!0,depth:!0,stencil:!0,alpha:!0,preserveDrawingBuffer:!0});function $(e){let i={};return{cur:s=>{let r=i[s]??[];return r[r.length-1]},push:(s,r)=>{i[s]||(i[s]=[]),i[s].push(r),e(s,r)},pop:s=>{let r=i[s];if(!r)throw new Error(`Unknown WebGL type: ${s}`);if(r.length<=0)throw new Error("Can't unbind texture when there's no texture bound");r.pop(),e(s,r[r.length-1]??null)}}}a($,"genBindFunc");let le=$(c.bindTexture.bind(c)),he=$(c.bindFramebuffer.bind(c)),He=$(c.bindRenderbuffer.bind(c));class ge{static{a(this,"Texture")}src=null;glTex;width;height;constructor(i,s,r={}){this.glTex=c.createTexture(),Y.push(()=>this.free()),this.bind(),i&&s&&c.texImage2D(c.TEXTURE_2D,0,c.RGBA,i,s,0,c.RGBA,c.UNSIGNED_BYTE,null),this.width=i,this.height=s;let o=(()=>{switch(r.filter??n.texFilter){case"linear":return c.LINEAR;case"nearest":return c.NEAREST;default:return c.NEAREST}})(),u=(()=>{switch(r.wrap){case"repeat":return c.REPEAT;case"clampToEdge":return c.CLAMP_TO_EDGE;default:return c.CLAMP_TO_EDGE}})();c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,o),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,o),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,u),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,u),this.unbind()}static fromImage(i,s={}){let r=new ge(0,0,s);return r.bind(),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,i),r.width=i.width,r.height=i.height,r.unbind(),r.src=i,r}update(i,s=0,r=0){this.bind(),c.texSubImage2D(c.TEXTURE_2D,0,s,r,c.RGBA,c.UNSIGNED_BYTE,i),this.unbind()}bind(){le.push(c.TEXTURE_2D,this.glTex)}unbind(){le.pop(c.TEXTURE_2D)}free(){c.deleteTexture(this.glTex)}}class k extends Error{static{a(this,"KaboomError")}constructor(i){super(i),this.name="KaboomError"}}class ze{static{a(this,"TexPacker")}tex;canvas;ctx;x=0;y=0;curHeight=0;constructor(i,s){this.canvas=document.createElement("canvas"),this.canvas.width=i,this.canvas.height=s,this.tex=ge.fromImage(this.canvas),this.ctx=this.canvas.getContext("2d")}add(i){if(i.width>this.canvas.width||i.height>this.canvas.height)throw new k(`Texture size (${i.width} x ${i.height}) exceeds limit (${this.canvas.width} x ${this.canvas.height})`);this.x+i.width>this.canvas.width&&(this.x=0,this.y+=this.curHeight,this.curHeight=0),this.y+i.height>this.canvas.height&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.tex=ge.fromImage(this.canvas),this.x=0,this.y=0,this.curHeight=0);let s=new E(this.x,this.y);return this.x+=i.width,i.height>this.curHeight&&(this.curHeight=i.height),i instanceof ImageData?this.ctx.putImageData(i,s.x,s.y):this.ctx.drawImage(i,s.x,s.y),this.tex.update(this.canvas),[this.tex,new me(s.x/this.canvas.width,s.y/this.canvas.height,i.width/this.canvas.width,i.height/this.canvas.height)]}}class Fe{static{a(this,"FrameBuffer")}tex;glFramebuffer;glRenderbuffer;constructor(i,s,r={}){this.tex=new ge(i,s,r),this.glFramebuffer=c.createFramebuffer(),this.glRenderbuffer=c.createRenderbuffer(),Y.push(()=>this.free()),this.bind(),c.renderbufferStorage(c.RENDERBUFFER,c.DEPTH_STENCIL,i,s),c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,this.tex.glTex,0),c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_STENCIL_ATTACHMENT,c.RENDERBUFFER,this.glRenderbuffer),this.unbind()}get width(){return this.tex.width}get height(){return this.tex.height}toImageData(){let i=new Uint8ClampedArray(this.width*this.height*4);this.bind(),c.readPixels(0,0,this.width,this.height,c.RGBA,c.UNSIGNED_BYTE,i),this.unbind();let s=this.width*4,r=new Uint8Array(s);for(let o=0;o<(this.height/2|0);o++){let u=o*s,g=(this.height-o-1)*s;r.set(i.subarray(u,u+s)),i.copyWithin(u,g,g+s),i.set(r,g)}return new ImageData(i,this.width,this.height)}toDataURL(){let i=document.createElement("canvas"),s=i.getContext("2d");return i.width=this.width,i.height=this.height,s.putImageData(this.toImageData(),0,0),i.toDataURL()}bind(){he.push(c.FRAMEBUFFER,this.glFramebuffer),He.push(c.RENDERBUFFER,this.glRenderbuffer)}unbind(){he.pop(c.FRAMEBUFFER),He.pop(c.RENDERBUFFER)}free(){c.deleteFramebuffer(this.glFramebuffer),c.deleteRenderbuffer(this.glRenderbuffer),this.tex.free()}}let v=(()=>{let e=ie(si,ri),i=ge.fromImage(new ImageData(new Uint8ClampedArray([255,255,255,255]),1,1)),s=n.width&&n.height?new Fe(n.width*P*f,n.height*P*f):new Fe(c.drawingBufferWidth,c.drawingBufferHeight),r=null,o=1;n.background&&(r=_.fromArray(n.background),o=n.background[3]??1,c.clearColor(r.r/255,r.g/255,r.b/255,o)),c.enable(c.BLEND),c.blendFuncSeparate(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA);let u=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,u),c.bufferData(c.ARRAY_BUFFER,_s*4,c.DYNAMIC_DRAW),wr.reduce((m,d,A)=>(c.vertexAttribPointer(A,d.size,c.FLOAT,!1,Sn*4,m),c.enableVertexAttribArray(A),m+d.size*4),0),c.bindBuffer(c.ARRAY_BUFFER,null);let g=c.createBuffer();c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,g),c.bufferData(c.ELEMENT_ARRAY_BUFFER,$s*4,c.DYNAMIC_DRAW),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,null);let w=ge.fromImage(new ImageData(new Uint8ClampedArray([128,128,128,255,190,190,190,255,190,190,190,255,128,128,128,255]),2,2),{wrap:"repeat",filter:"nearest"});return{drawCalls:0,lastDrawCalls:0,defShader:e,curShader:e,frameBuffer:s,postShader:null,postShaderUniform:null,defTex:i,curTex:i,curUniform:{},vbuf:u,ibuf:g,vqueue:[],iqueue:[],transform:new Pe,transformStack:[],bgTex:w,bgColor:r,bgAlpha:o,width:n.width??c.drawingBufferWidth/P/f,height:n.height??c.drawingBufferHeight/P/f,viewport:{x:0,y:0,width:c.drawingBufferWidth,height:c.drawingBufferHeight},fixed:!1}})();class oe{static{a(this,"SpriteData")}tex;frames=[new me(0,0,1,1)];anims={};slice9=null;constructor(i,s,r={},o=null){this.tex=i,s&&(this.frames=s),this.anims=r,this.slice9=o}get width(){return this.tex.width*this.frames[0].w}get height(){return this.tex.height*this.frames[0].h}static from(i,s={}){return typeof i=="string"?oe.fromURL(i,s):Promise.resolve(oe.fromImage(i,s))}static fromImage(i,s={}){let[r,o]=K.packer.add(i),u=s.frames?s.frames.map(g=>new me(o.x+g.x*o.w,o.y+g.y*o.h,g.w*o.w,g.h*o.h)):at(s.sliceX||1,s.sliceY||1,o.x,o.y,o.w,o.h);return new oe(r,u,s.anims,s.slice9)}static fromURL(i,s={}){return Je(i).then(r=>oe.fromImage(r,s))}}class we{static{a(this,"SoundData")}buf;constructor(i){this.buf=i}static fromArrayBuffer(i){return new Promise((s,r)=>ee.ctx.decodeAudioData(i,s,r)).then(s=>new we(s))}static fromURL(i){return Ns(i)?we.fromArrayBuffer(mr(i)):an(i).then(s=>we.fromArrayBuffer(s))}}let ee=(()=>{let e=new(window.AudioContext||window.webkitAudioContext),i=e.createGain();i.connect(e.destination);let s=new we(Vr(e));return e.decodeAudioData(po.buffer.slice(0)).then(r=>{s.buf=r}).catch(r=>{console.error("Failed to load burp: ",r)}),{ctx:e,masterNode:i,burpSnd:s}})();class ue{static{a(this,"Asset")}loaded=!1;data=null;error=null;onLoadEvents=new Be;onErrorEvents=new Be;onFinishEvents=new Be;constructor(i){i.then(s=>{this.data=s,this.onLoadEvents.trigger(s)}).catch(s=>{if(this.error=s,this.onErrorEvents.numListeners()>0)this.onErrorEvents.trigger(s);else throw s}).finally(()=>{this.onFinishEvents.trigger(),this.loaded=!0})}static loaded(i){let s=new ue(Promise.resolve(i));return s.data=i,s.loaded=!0,s}onLoad(i){return this.loaded&&this.data?i(this.data):this.onLoadEvents.add(i),this}onError(i){return this.loaded&&this.error?i(this.error):this.onErrorEvents.add(i),this}onFinish(i){return this.loaded?i():this.onFinishEvents.add(i),this}then(i){return this.onLoad(i)}catch(i){return this.onError(i)}finally(i){return this.onFinish(i)}}class De{static{a(this,"AssetBucket")}assets=new Map;lastUID=0;add(i,s){let r=i??this.lastUID+++"",o=new ue(s);return this.assets.set(r,o),o}addLoaded(i,s){let r=i??this.lastUID+++"",o=ue.loaded(s);return this.assets.set(r,o),o}get(i){return this.assets.get(i)}progress(){if(this.assets.size===0)return 1;let i=0;return this.assets.forEach(s=>{s.loaded&&i++}),i/this.assets.size}}let K={urlPrefix:"",sprites:new De,fonts:new De,bitmapFonts:new De,sounds:new De,shaders:new De,custom:new De,packer:new ze(Qs,Js),loaded:!1},T={events:new nn,objEvents:new nn,root:dn([]),gravity:0,scenes:{},logs:[],cam:{pos:null,scale:new E(1),angle:0,shake:0,transform:new Pe}};function rt(e){return K.custom.add(null,e)}a(rt,"load");function Re(){let e=[K.sprites,K.sounds,K.shaders,K.fonts,K.bitmapFonts,K.custom];return e.reduce((i,s)=>i+s.progress(),0)/e.length}a(Re,"loadProgress");function Ft(e){return e!==void 0&&(K.urlPrefix=e),K.urlPrefix}a(Ft,"loadRoot");function Qe(e){let i=K.urlPrefix+e;return fetch(i).then(s=>{if(!s.ok)throw new k(`Failed to fetch "${i}"`);return s})}a(Qe,"fetchURL");function je(e){return Qe(e).then(i=>i.json())}a(je,"fetchJSON");function Dt(e){return Qe(e).then(i=>i.text())}a(Dt,"fetchText");function an(e){return Qe(e).then(i=>i.arrayBuffer())}a(an,"fetchArrayBuffer");function Je(e){let i=new Image;return i.crossOrigin="anonymous",i.src=Ns(e)?e:K.urlPrefix+e,new Promise((s,r)=>{i.onload=()=>s(i),i.onerror=()=>r(new k(`Failed to load image from "${e}"`))})}a(Je,"loadImg");function ln(e,i){return K.custom.add(e,je(i))}a(ln,"loadJSON");class ot{static{a(this,"FontData")}fontface;filter=ii;outline=null;constructor(i,s={}){this.fontface=i,this.filter=s.filter??ii,s.outline&&(this.outline={width:1,color:Z(0,0,0)},typeof s.outline=="number"?this.outline.width=s.outline:typeof s.outline=="object"&&(s.outline.width&&(this.outline.width=s.outline.width),s.outline.color&&(this.outline.color=s.outline.color)))}}function It(e,i,s={}){let r=new FontFace(e,typeof i=="string"?`url(${i})`:i);return document.fonts.add(r),K.fonts.add(e,r.load().catch(o=>{throw new k(`Failed to load font from "${i}": ${o}`)}).then(o=>new ot(o,s)))}a(It,"loadFont");function Ut(e,i,s,r,o={}){return K.bitmapFonts.add(e,Je(i).then(u=>qe(ge.fromImage(u,o),s,r,o.chars??qs)))}a(Ut,"loadBitmapFont");function at(e=1,i=1,s=0,r=0,o=1,u=1){let g=[],w=o/e,m=u/i;for(let d=0;d<i;d++)for(let A=0;A<e;A++)g.push(new me(s+A*w,r+d*m,w,m));return g}a(at,"slice");function lt(e,i){return rt(typeof i=="string"?new Promise((s,r)=>{je(i).then(o=>{lt(e,o).then(s).catch(r)})}):oe.from(e).then(s=>{let r={};for(let o in i){let u=i[o],g=s.frames[0],w=Qs*g.w,m=Js*g.h,d=u.frames?u.frames.map(R=>new me(g.x+(u.x+R.x)/w*g.w,g.y+(u.y+R.y)/m*g.h,R.w/w*g.w,R.h/m*g.h)):at(u.sliceX||1,u.sliceY||1,g.x+u.x/w*g.w,g.y+u.y/m*g.h,u.width/w*g.w,u.height/m*g.h),A=new oe(s.tex,d,u.anims);K.sprites.addLoaded(o,A),r[o]=A}return r}))}a(lt,"loadSpriteAtlas");function ht(e,i={}){let s=document.createElement("canvas"),r=e[0].width,o=e[0].height;s.width=r*e.length,s.height=o;let u=s.getContext("2d");e.forEach((w,m)=>{w instanceof ImageData?u.putImageData(w,m*r,0):u.drawImage(w,m*r,0)});let g=u.getImageData(0,0,e.length*r,o);return oe.fromImage(g,{...i,sliceX:e.length,sliceY:1})}a(ht,"createSpriteSheet");function Ie(e,i,s={sliceX:1,sliceY:1,anims:{}}){return Array.isArray(i)?i.some(r=>typeof r=="string")?K.sprites.add(e,Promise.all(i.map(r=>typeof r=="string"?Je(r):Promise.resolve(r))).then(r=>ht(r,s))):K.sprites.addLoaded(e,ht(i,s)):typeof i=="string"?K.sprites.add(e,oe.from(i,s)):K.sprites.addLoaded(e,oe.fromImage(i,s))}a(Ie,"loadSprite");function Lt(e,i){return K.sprites.add(e,new Promise(async s=>{let r=typeof i=="string"?await je(i):i,o=await Promise.all(r.frames.map(Je)),u=document.createElement("canvas");u.width=r.width,u.height=r.height*r.frames.length;let g=u.getContext("2d");o.forEach((m,d)=>{g.drawImage(m,0,d*r.height)});let w=await Ie(null,u,{sliceY:r.frames.length,anims:r.anims});s(w)}))}a(Lt,"loadPedit");function Nt(e,i,s){typeof i=="string"&&!s&&(s=i.replace(new RegExp(`${so(i)}$`),"json"));let r=typeof s=="string"?je(s):Promise.resolve(s);return K.sprites.add(e,r.then(o=>{let u=o.meta.size,g=o.frames.map(m=>new me(m.frame.x/u.w,m.frame.y/u.h,m.frame.w/u.w,m.frame.h/u.h)),w={};for(let m of o.meta.frameTags)m.from===m.to?w[m.name]=m.from:w[m.name]={from:m.from,to:m.to,speed:10,loop:!0,pingpong:m.direction==="pingpong"};return oe.from(i,{frames:g,anims:w})}))}a(Nt,"loadAseprite");function Ot(e,i,s){return K.shaders.addLoaded(e,ie(i,s))}a(Ot,"loadShader");function Gt(e,i,s){let r=a(u=>u?Dt(u):Promise.resolve(null),"resolveUrl"),o=Promise.all([r(i),r(s)]).then(([u,g])=>ie(u,g));return K.shaders.add(e,o)}a(Gt,"loadShaderURL");function Ht(e,i){return K.sounds.add(e,typeof i=="string"?we.fromURL(i):we.fromArrayBuffer(i))}a(Ht,"loadSound");function jt(e="bean"){return Ie(e,co)}a(jt,"loadBean");function ut(e){return K.sprites.get(e)}a(ut,"getSprite");function dt(e){return K.sounds.get(e)}a(dt,"getSound");function ct(e){return K.fonts.get(e)}a(ct,"getFont");function pt(e){return K.bitmapFonts.get(e)}a(pt,"getBitmapFont");function ft(e){return K.shaders.get(e)}a(ft,"getShader");function qt(e){return K.custom.get(e)}a(qt,"getAsset");function Ze(e){if(typeof e=="string"){let i=ut(e);if(i)return i;if(Re()<1)return null;throw new k(`Sprite not found: ${e}`)}else{if(e instanceof oe)return ue.loaded(e);if(e instanceof ue)return e;throw new k(`Invalid sprite: ${e}`)}}a(Ze,"resolveSprite");function mt(e){if(typeof e=="string"){let i=dt(e);if(i)return i;if(Re()<1)return null;throw new k(`Sound not found: ${e}`)}else{if(e instanceof we)return ue.loaded(e);if(e instanceof ue)return e;throw new k(`Invalid sound: ${e}`)}}a(mt,"resolveSound");function Kt(e){if(!e)return v.defShader;if(typeof e=="string"){let i=ft(e);if(i)return i.data??i;if(Re()<1)return null;throw new k(`Shader not found: ${e}`)}else if(e instanceof ue)return e.data?e.data:e;return e}a(Kt,"resolveShader");function gt(e){if(!e)return gt(n.font??wo);if(typeof e=="string"){let i=pt(e),s=ct(e);if(i)return i.data??i;if(s)return s.data??s;if(document.fonts.check(`${Ys}px ${e}`))return e;if(Re()<1)return null;throw new k(`Font not found: ${e}`)}else if(e instanceof ue)return e.data?e.data:e;return e}a(gt,"resolveFont");function wt(e){return e!==void 0&&(ee.masterNode.gain.value=e),ee.masterNode.gain.value}a(wt,"volume");function At(e,i={}){let s=ee.ctx,r=i.paused??!1,o=s.createBufferSource(),u=new Be,g=s.createGain(),w=i.seek??0,m=0,d=0,A=!1;o.loop=!!i.loop,o.detune.value=i.detune??0,o.playbackRate.value=i.speed??1,o.connect(g),o.onended=()=>{L()>=o.buffer?.duration&&u.trigger()},g.connect(ee.masterNode),g.gain.value=i.volume??1;let R=a(I=>{o.buffer=I.buf,r||(m=s.currentTime,o.start(0,w),A=!0)},"start"),C=mt(e);C instanceof ue&&C.onLoad(R);let L=a(()=>{if(!o.buffer)return 0;let I=r?d-m:s.currentTime-m,N=o.buffer.duration;return o.loop?I%N:Math.min(I,N)},"getTime"),G=a(I=>{let N=s.createBufferSource();return N.buffer=I.buffer,N.loop=I.loop,N.playbackRate.value=I.playbackRate.value,N.detune.value=I.detune.value,N.onended=I.onended,N.connect(g),N},"cloneNode");return{stop(){this.paused=!0,this.seek(0)},set paused(I){if(r!==I)if(r=I,I)A&&(o.stop(),A=!1),d=s.currentTime;else{o=G(o);let N=d-m;o.start(0,N),A=!0,m=s.currentTime-N,d=0}},get paused(){return r},play(I=0){this.seek(I),this.paused=!1},seek(I){o.buffer?.duration&&(I>o.buffer.duration||(r?(o=G(o),m=d-I):(o.stop(),o=G(o),m=s.currentTime-I,o.start(0,I),A=!0,d=0)))},set speed(I){o.playbackRate.value=I},get speed(){return o.playbackRate.value},set detune(I){o.detune.value=I},get detune(){return o.detune.value},set volume(I){g.gain.value=Math.max(I,0)},get volume(){return g.gain.value},set loop(I){o.loop=I},get loop(){return o.loop},duration(){return o.buffer?.duration??0},time(){return L()%this.duration()},onEnd(I){return u.add(I)},then(I){return this.onEnd(I)}}}a(At,"play");function vt(e){return At(ee.burpSnd,e)}a(vt,"burp");function ie(e=si,i=ri){let s=xo.replace("{{user}}",e??si),r=bo.replace("{{user}}",i??ri),o=c.createShader(c.VERTEX_SHADER),u=c.createShader(c.FRAGMENT_SHADER);c.shaderSource(o,s),c.shaderSource(u,r),c.compileShader(o),c.compileShader(u);let g=c.createProgram();if(Y.push(()=>c.deleteProgram(g)),c.attachShader(g,o),c.attachShader(g,u),c.bindAttribLocation(g,0,"a_pos"),c.bindAttribLocation(g,1,"a_uv"),c.bindAttribLocation(g,2,"a_color"),c.linkProgram(g),!c.getProgramParameter(g,c.LINK_STATUS)){let w=a(R=>{let C=/^ERROR:\s0:(?<line>\d+):\s(?<msg>.+)/,L=R.match(C);return{line:Number(L.groups.line),msg:L.groups.msg.replace(/\n\0$/,"")}},"formatShaderError"),m=c.getShaderInfoLog(o),d=c.getShaderInfoLog(u),A="";if(m){let R=w(m);A+=`Vertex shader line ${R.line-14}: ${R.msg}`}if(d){let R=w(d);A+=`Fragment shader line ${R.line-14}: ${R.msg}`}throw new k(A)}return c.deleteShader(o),c.deleteShader(u),{bind(){c.useProgram(g)},unbind(){c.useProgram(null)},free(){c.deleteProgram(g)},send(w){for(let m in w){let d=w[m],A=c.getUniformLocation(g,m);typeof d=="number"?c.uniform1f(A,d):d instanceof Pe?c.uniformMatrix4fv(A,!1,new Float32Array(d.m)):d instanceof _?c.uniform3f(A,d.r,d.g,d.b):d instanceof E&&c.uniform2f(A,d.x,d.y)}}}}a(ie,"makeShader");function qe(e,i,s,r){let o=e.width/i,u={},g=r.split("").entries();for(let[w,m]of g)u[m]=new me(w%o*i,Math.floor(w/o)*s,i,s);return{tex:e,map:u,size:s}}a(qe,"makeFont");function Me(e,i,s,r=v.defTex,o=v.defShader,u={}){let g=Kt(o);if(!g||g instanceof ue)return;(r!==v.curTex||g!==v.curShader||!Ai(v.curUniform,u)||v.vqueue.length+e.length*Sn>_s||v.iqueue.length+i.length>$s)&&be();let w=v.fixed||s?v.transform:T.cam.transform.mult(v.transform);for(let m of e){let d=Yt(w.multVec2(m.pos));v.vqueue.push(d.x,d.y,m.uv.x,m.uv.y,m.color.r/255,m.color.g/255,m.color.b/255,m.opacity)}for(let m of i)v.iqueue.push(m+v.vqueue.length/Sn-e.length);v.curTex=r,v.curShader=g,v.curUniform=u}a(Me,"drawRaw");function be(){!v.curTex||!v.curShader||v.vqueue.length===0||v.iqueue.length===0||(c.bindBuffer(c.ARRAY_BUFFER,v.vbuf),c.bufferSubData(c.ARRAY_BUFFER,0,new Float32Array(v.vqueue)),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,v.ibuf),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,new Uint16Array(v.iqueue)),v.curShader.bind(),v.curShader.send(v.curUniform),v.curTex.bind(),c.drawElements(c.TRIANGLES,v.iqueue.length,c.UNSIGNED_SHORT,0),v.curTex.unbind(),v.curShader.unbind(),c.bindBuffer(c.ARRAY_BUFFER,null),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,null),v.vqueue.length=0,v.iqueue.length=0,v.drawCalls++)}a(be,"flush");function Vt(){c.clear(c.COLOR_BUFFER_BIT),v.frameBuffer.bind(),c.viewport(0,0,v.frameBuffer.width,v.frameBuffer.height),c.clear(c.COLOR_BUFFER_BIT),v.bgColor||Ue(()=>{de({width:Ae(),height:ve(),quad:new me(0,0,Ae()/Ks,ve()/Ks),tex:v.bgTex,fixed:!0})}),v.drawCalls=0,v.fixed=!1,v.transformStack.length=0,v.transform=new Pe}a(Vt,"frameStart");function hn(e,i){v.postShader=e,v.postShaderUniform=i??null}a(hn,"usePostEffect");function yt(){be(),v.lastDrawCalls=v.drawCalls,v.frameBuffer.unbind(),c.viewport(0,0,c.drawingBufferWidth,c.drawingBufferHeight);let e=v.width,i=v.height;v.width=c.drawingBufferWidth/P,v.height=c.drawingBufferHeight/P,_e({flipY:!0,tex:v.frameBuffer.tex,pos:new E(v.viewport.x,v.viewport.y),width:v.viewport.width,height:v.viewport.height,shader:v.postShader,uniform:typeof v.postShaderUniform=="function"?v.postShaderUniform():v.postShaderUniform,fixed:!0}),be(),v.width=e,v.height=i}a(yt,"frameEnd");function Yt(e){return new E(e.x/Ae()*2-1,-e.y/ve()*2+1)}a(Yt,"screen2ndc");function p(e){v.transform=e.clone()}a(p,"pushMatrix");function V(...e){if(e[0]===void 0)return;let i=B(...e);i.x===0&&i.y===0||v.transform.translate(i)}a(V,"pushTranslate");function S(...e){if(e[0]===void 0)return;let i=B(...e);i.x===1&&i.y===1||v.transform.scale(i)}a(S,"pushScale");function j(e){e&&v.transform.rotate(e)}a(j,"pushRotate");function O(){v.transformStack.push(v.transform.clone())}a(O,"pushTransform");function te(){v.transformStack.length>0&&(v.transform=v.transformStack.pop())}a(te,"popTransform");function de(e){if(e.width===void 0||e.height===void 0)throw new k('drawUVQuad() requires property "width" and "height".');if(e.width<=0||e.height<=0)return;let i=e.width,s=e.height,r=it(e.anchor||Vn).scale(new E(i,s).scale(-.5)),o=e.quad||new me(0,0,1,1),u=e.color||Z(255,255,255),g=e.opacity??1,w=e.tex?Zs/e.tex.width:0,m=e.tex?Zs/e.tex.height:0,d=o.x+w,A=o.y+m,R=o.w-w*2,C=o.h-m*2;O(),V(e.pos),j(e.angle),S(e.scale),V(r),Me([{pos:new E(-i/2,s/2),uv:new E(e.flipX?d+R:d,e.flipY?A:A+C),color:u,opacity:g},{pos:new E(-i/2,-s/2),uv:new E(e.flipX?d+R:d,e.flipY?A+C:A),color:u,opacity:g},{pos:new E(i/2,-s/2),uv:new E(e.flipX?d:d+R,e.flipY?A+C:A),color:u,opacity:g},{pos:new E(i/2,s/2),uv:new E(e.flipX?d:d+R,e.flipY?A:A+C),color:u,opacity:g}],[0,1,3,1,2,3],e.fixed,e.tex,e.shader,e.uniform),te()}a(de,"drawUVQuad");function _e(e){if(!e.tex)throw new k('drawTexture() requires property "tex".');let i=e.quad??new me(0,0,1,1),s=e.tex.width*i.w,r=e.tex.height*i.h,o=new E(1);if(e.tiled){let u=Math.ceil((e.width||s)/s),g=Math.ceil((e.height||r)/r),w=it(e.anchor||Vn).add(new E(1,1)).scale(.5).scale(u*s,g*r);for(let m=0;m<u;m++)for(let d=0;d<g;d++)de(Object.assign({},e,{pos:(e.pos||new E(0)).add(new E(s*m,r*d)).sub(w),scale:o.scale(e.scale||new E(1)),tex:e.tex,quad:i,width:s,height:r,anchor:"topleft"}))}else e.width&&e.height?(o.x=e.width/s,o.y=e.height/r):e.width?(o.x=e.width/s,o.y=o.x):e.height&&(o.y=e.height/r,o.x=o.y),de(Object.assign({},e,{scale:o.scale(e.scale||new E(1)),tex:e.tex,quad:i,width:s,height:r}))}a(_e,"drawTexture");function un(e){if(!e.sprite)throw new k('drawSprite() requires property "sprite"');let i=Ze(e.sprite);if(!i||!i.data)return;let s=i.data.frames[e.frame??0];if(!s)throw new k(`Frame not found: ${e.frame??0}`);_e(Object.assign({},e,{tex:i.data.tex,quad:s.scale(e.quad??new me(0,0,1,1))}))}a(un,"drawSprite");function ye(e,i,s,r,o,u=1){r=Te(r%360),o=Te(o%360),o<=r&&(o+=Math.PI*2);let g=[],w=Math.ceil((o-r)/Te(8)*u),m=(o-r)/w;for(let d=r;d<o;d+=m)g.push(e.add(i*Math.cos(d),s*Math.sin(d)));return g.push(e.add(i*Math.cos(o),s*Math.sin(o))),g}a(ye,"getArcPts");function ce(e){if(e.width===void 0||e.height===void 0)throw new k('drawRect() requires property "width" and "height".');if(e.width<=0||e.height<=0)return;let i=e.width,s=e.height,r=it(e.anchor||Vn).add(1,1).scale(new E(i,s).scale(-.5)),o=[new E(0,0),new E(i,0),new E(i,s),new E(0,s)];if(e.radius){let u=Math.min(Math.min(i,s)/2,e.radius);o=[new E(u,0),new E(i-u,0),...ye(new E(i-u,u),u,u,270,360),new E(i,u),new E(i,s-u),...ye(new E(i-u,s-u),u,u,0,90),new E(i-u,s),new E(u,s),...ye(new E(u,s-u),u,u,90,180),new E(0,s-u),new E(0,u),...ye(new E(u,u),u,u,180,270)]}Ke(Object.assign({},e,{offset:r,pts:o,...e.gradient?{colors:e.horizontal?[e.gradient[0],e.gradient[1],e.gradient[1],e.gradient[0]]:[e.gradient[0],e.gradient[0],e.gradient[1],e.gradient[1]]}:{}}))}a(ce,"drawRect");function xt(e){let{p1:i,p2:s}=e;if(!i||!s)throw new k('drawLine() requires properties "p1" and "p2".');let r=e.width||1,o=s.sub(i).unit().normal().scale(r*.5),u=[i.sub(o),i.add(o),s.add(o),s.sub(o)].map(g=>({pos:new E(g.x,g.y),uv:new E(0),color:e.color??_.WHITE,opacity:e.opacity??1}));Me(u,[0,1,3,1,2,3],e.fixed,v.defTex,e.shader,e.uniform)}a(xt,"drawLine");function Bn(e){let i=e.pts;if(!i)throw new k('drawLines() requires property "pts".');if(!(i.length<2))if(e.radius&&i.length>=3){let s=i[0].sdist(i[1]);for(let o=1;o<i.length-1;o++)s=Math.min(i[o].sdist(i[o+1]),s);let r=Math.min(e.radius,Math.sqrt(s)/2);xt(Object.assign({},e,{p1:i[0],p2:i[1]}));for(let o=1;o<i.length-2;o++){let u=i[o],g=i[o+1];xt(Object.assign({},e,{p1:u,p2:g}))}xt(Object.assign({},e,{p1:i[i.length-2],p2:i[i.length-1]}))}else for(let s=0;s<i.length-1;s++)xt(Object.assign({},e,{p1:i[s],p2:i[s+1]})),e.join!=="none"&&$e(Object.assign({},e,{pos:i[s],radius:e.width/2}))}a(Bn,"drawLines");function Pn(e){if(!e.p1||!e.p2||!e.p3)throw new k('drawPolygon() requires properties "p1", "p2" and "p3".');return Ke(Object.assign({},e,{pts:[e.p1,e.p2,e.p3]}))}a(Pn,"drawTriangle");function $e(e){if(typeof e.radius!="number")throw new k('drawCircle() requires property "radius".');e.radius!==0&&Tn(Object.assign({},e,{radiusX:e.radius,radiusY:e.radius,angle:0}))}a($e,"drawCircle");function Tn(e){if(e.radiusX===void 0||e.radiusY===void 0)throw new k('drawEllipse() requires properties "radiusX" and "radiusY".');if(e.radiusX===0||e.radiusY===0)return;let i=e.start??0,s=e.end??360,r=it(e.anchor??"center").scale(new E(-e.radiusX,-e.radiusY)),o=ye(r,e.radiusX,e.radiusY,i,s,e.resolution);o.unshift(r);let u=Object.assign({},e,{pts:o,radius:0,...e.gradient?{colors:[e.gradient[0],...Array(o.length-1).fill(e.gradient[1])]}:{}});if(s-i>=360&&e.outline){e.fill!==!1&&Ke(Object.assign(u,{outline:null})),Ke(Object.assign(u,{pts:o.slice(1),fill:!1}));return}Ke(u)}a(Tn,"drawEllipse");function Ke(e){if(!e.pts)throw new k('drawPolygon() requires property "pts".');let i=e.pts.length;if(!(i<3)){if(O(),V(e.pos),S(e.scale),j(e.angle),V(e.offset),e.fill!==!1){let s=e.color??_.WHITE,r=e.pts.map((u,g)=>({pos:new E(u.x,u.y),uv:new E(0,0),color:e.colors?e.colors[g]??s:s,opacity:e.opacity??1})),o=[...Array(i-2).keys()].map(u=>[0,u+1,u+2]).flat();Me(r,e.indices??o,e.fixed,v.defTex,e.shader,e.uniform)}e.outline&&Bn({pts:[...e.pts,e.pts[0]],radius:e.radius,width:e.outline.width,color:e.outline.color,join:e.outline.join,uniform:e.uniform,fixed:e.fixed,opacity:e.opacity}),te()}}a(Ke,"drawPolygon");function Cn(e,i,s){be(),c.clear(c.STENCIL_BUFFER_BIT),c.enable(c.STENCIL_TEST),c.stencilFunc(c.NEVER,1,255),c.stencilOp(c.REPLACE,c.REPLACE,c.REPLACE),i(),be(),c.stencilFunc(s,1,255),c.stencilOp(c.KEEP,c.KEEP,c.KEEP),e(),be(),c.disable(c.STENCIL_TEST)}a(Cn,"drawStenciled");function kn(e,i){Cn(e,i,c.EQUAL)}a(kn,"drawMasked");function Fn(e,i){Cn(e,i,c.NOTEQUAL)}a(Fn,"drawSubtracted");function Dn(){return(v.viewport.width+v.viewport.height)/(v.width+v.height)}a(Dn,"getViewportScale");function Ue(e){be();let i=v.width,s=v.height;v.width=v.viewport.width,v.height=v.viewport.height,e(),be(),v.width=i,v.height=s}a(Ue,"drawUnscaled");function In(e,i){i.pos&&(e.pos=e.pos.add(i.pos)),i.scale&&(e.scale=e.scale.scale(B(i.scale))),i.angle&&(e.angle+=i.angle),i.color&&(e.color=e.color.mult(i.color)),i.opacity&&(e.opacity*=i.opacity)}a(In,"applyCharTransform");let Ri=/\[(?<style>\w+)\](?<text>.*?)\[\/\k<style>\]/g;function Mi(e){let i={},s=e.replace(Ri,"$2"),r=0;for(let o of e.matchAll(Ri)){let u=o.index-r;for(let g=0;g<o.groups.text.length;g++)i[g+u]=[o.groups.style];r+=o[0].length-o.groups.text.length}return{charStyleMap:i,text:s}}a(Mi,"compileStyledText");let Un={};function Ye(e){if(e.text===void 0)throw new k('formatText() requires property "text".');let i=gt(e.font);if(e.text===""||i instanceof ue||!i)return{width:0,height:0,chars:[],opt:e};let{charStyleMap:s,text:r}=Mi(e.text+""),o=r.split("");if(i instanceof ot||typeof i=="string"){let X=i instanceof ot?i.fontface.family:i,z=i instanceof ot?{outline:i.outline,filter:i.filter}:{outline:null,filter:ii},H=Un[X]??{font:{tex:new ge(Xs,zs,{filter:z.filter}),map:{},size:Ys},cursor:new E(0),outline:z.outline};Un[X]||(Un[X]=H),i=H.font;for(let pe of o)if(!H.font.map[pe]){let b=W;b.clearRect(0,0,q.width,q.height),b.font=`${i.size}px ${X}`,b.textBaseline="top",b.textAlign="left",b.fillStyle="#ffffff";let F=b.measureText(pe),D=Math.ceil(F.width),U=i.size;H.outline&&(b.lineJoin="round",b.lineWidth=H.outline.width*2,b.strokeStyle=H.outline.color.toHex(),b.strokeText(pe,H.outline.width,H.outline.width),D+=H.outline.width*2,U+=H.outline.width*3),b.fillText(pe,H.outline?.width??0,H.outline?.width??0);let Q=b.getImageData(0,0,D,U);if(H.cursor.x+D>Xs&&(H.cursor.x=0,H.cursor.y+=U,H.cursor.y>zs))throw new k("Font atlas exceeds character limit");i.tex.update(Q,H.cursor.x,H.cursor.y),i.map[pe]=new me(H.cursor.x,H.cursor.y,D,U),H.cursor.x+=D}}let u=e.size||i.size,g=B(e.scale??1).scale(u/i.size),w=e.lineSpacing??0,m=e.letterSpacing??0,d=0,A=0,R=0,C=[],L=[],G=0,I=null,N=null;for(;G<o.length;){let X=o[G];if(X===`
`)R+=u+w,C.push({width:d-m,chars:L}),I=null,N=null,d=0,L=[];else{let z=i.map[X];if(z){let H=z.w*g.x;e.width&&d+H>e.width&&(R+=u+w,I!=null&&(G-=L.length-I,X=o[G],z=i.map[X],H=z.w*g.x,L=L.slice(0,I-1),d=N),I=null,N=null,C.push({width:d-m,chars:L}),d=0,L=[]),L.push({tex:i.tex,width:z.w,height:z.h,quad:new me(z.x/i.tex.width,z.y/i.tex.height,z.w/i.tex.width,z.h/i.tex.height),ch:X,pos:new E(d,R),opacity:e.opacity??1,color:e.color??_.WHITE,scale:B(g),angle:0}),X===" "&&(I=L.length,N=d),d+=H,A=Math.max(A,d),d+=m}}G++}C.push({width:d-m,chars:L}),R+=u,e.width&&(A=e.width);let Se=[];for(let X of C){let z=(A-X.width)*vr(e.align??"left");for(let H of X.chars){let pe=i.map[H.ch],b=Se.length;if(H.pos=H.pos.add(z,0).add(pe.w*g.x*.5,pe.h*g.y*.5),e.transform){let F=typeof e.transform=="function"?e.transform(b,H.ch):e.transform;F&&In(H,F)}if(s[b]){let F=s[b];for(let D of F){let U=e.styles[D],Q=typeof U=="function"?U(b,H.ch):U;Q&&In(H,Q)}}Se.push(H)}}return{width:A,height:R,chars:Se,opt:e}}a(Ye,"formatText");function Ln(e){We(Ye(e))}a(Ln,"drawText");function We(e){O(),V(e.opt.pos),j(e.opt.angle),V(it(e.opt.anchor??"topleft").add(1,1).scale(e.width,e.height).scale(-.5)),e.chars.forEach(i=>{de({tex:i.tex,width:i.width,height:i.height,pos:i.pos,scale:i.scale,angle:i.angle,color:i.color,opacity:i.opacity,quad:i.quad,anchor:"center",uniform:e.opt.uniform,shader:e.opt.shader,fixed:e.opt.fixed})}),te()}a(We,"drawFormattedText");function Ae(){return v.width}a(Ae,"width");function ve(){return v.height}a(ve,"height");let bt={};function Bi(e){return new E((e.x-v.viewport.x)*Ae()/v.viewport.width,(e.y-v.viewport.y)*ve()/v.viewport.height)}a(Bi,"windowToContent");function Pi(e){return new E(e.x*v.viewport.width/v.width,e.y*v.viewport.height/v.height)}a(Pi,"contentToView");function Wt(){return Bi(x.mousePos())}a(Wt,"mousePos"),bt.error=e=>{e.error&&e.error instanceof k?gn(e.error):e instanceof k&&gn(e)},bt.unhandledrejection=e=>{e.reason instanceof k&&gn(e.reason)};for(let e in bt)window.addEventListener(e,bt[e]);let Ti=!1,ne={inspect:!1,timeScale:1,showLog:!0,fps:()=>x.fps(),numFrames:()=>x.numFrames(),stepFrame:Qn,drawCalls:()=>v.lastDrawCalls,clearLog:()=>T.logs=[],log:e=>{let i=n.logMax??Vo;T.logs.unshift({msg:e,time:x.time()}),T.logs.length>i&&(T.logs=T.logs.slice(0,i))},error:e=>ne.log(new k(e.toString?e.toString():e)),curRecording:null,numObjects:()=>Xn("*",{recursive:!0}).length,get paused(){return Ti},set paused(e){Ti=e,e?ee.ctx.suspend():ee.ctx.resume()}};function Ee(){return x.dt()*ne.timeScale}a(Ee,"dt");function Ci(...e){return e.length>0&&(T.cam.pos=B(...e)),T.cam.pos?T.cam.pos.clone():_t()}a(Ci,"camPos");function ki(...e){return e.length>0&&(T.cam.scale=B(...e)),T.cam.scale.clone()}a(ki,"camScale");function Fi(e){return e!==void 0&&(T.cam.angle=e),T.cam.angle}a(Fi,"camRot");function Di(e=12){T.cam.shake+=e}a(Di,"shake");function Nn(e){return T.cam.transform.multVec2(e)}a(Nn,"toScreen");function On(e){return T.cam.transform.invert().multVec2(e)}a(On,"toWorld");function Xt(e){let i=new Pe;return e.pos&&i.translate(e.pos),e.scale&&i.scale(e.scale),e.angle&&i.rotate(e.angle),e.parent?i.mult(e.parent.transform):i}a(Xt,"calcTransform");function dn(e=[]){let i=new Map,s={},r=new nn,o=[],u=null,g=!1,w={id:ro(),hidden:!1,transform:new Pe,children:[],parent:null,set paused(d){if(d!==g){g=d;for(let A of o)A.paused=d}},get paused(){return g},add(d=[]){let A=Array.isArray(d)?dn(d):d;if(A.parent)throw new k("Cannot add a game obj that already has a parent.");return A.parent=this,A.transform=Xt(A),this.children.push(A),A.trigger("add",A),T.events.trigger("add",A),A},readd(d){let A=this.children.indexOf(d);return A!==-1&&(this.children.splice(A,1),this.children.push(d)),d},remove(d){let A=this.children.indexOf(d);if(A!==-1){d.parent=null,this.children.splice(A,1);let R=a(C=>{C.trigger("destroy"),T.events.trigger("destroy",C),C.children.forEach(L=>R(L))},"trigger");R(d)}},removeAll(d){if(d)this.get(d).forEach(A=>this.remove(A));else for(let A of[...this.children])this.remove(A)},update(){this.paused||(this.children.sort((d,A)=>(d.z??0)-(A.z??0)).forEach(d=>d.update()),this.trigger("update"))},draw(){if(this.hidden)return;let d=v.fixed;this.fixed&&(v.fixed=!0),O(),V(this.pos),S(this.scale),j(this.angle);let A=this.children.sort((R,C)=>(R.z??0)-(C.z??0));if(this.mask){let R={intersect:kn,subtract:Fn}[this.mask];if(!R)throw new k(`Invalid mask func: "${this.mask}"`);R(()=>{A.forEach(C=>C.draw())},()=>{this.trigger("draw")})}else this.trigger("draw"),A.forEach(R=>R.draw());te(),v.fixed=d},drawInspect(){this.hidden||(O(),V(this.pos),S(this.scale),j(this.angle),this.children.sort((d,A)=>(d.z??0)-(A.z??0)).forEach(d=>d.drawInspect()),this.trigger("drawInspect"),te())},use(d){if(!d)return;if(typeof d=="string")return this.use({id:d});let A=[];d.id&&(this.unuse(d.id),s[d.id]=[],A=s[d.id],i.set(d.id,d));for(let C in d){if(Eo.has(C))continue;let L=Object.getOwnPropertyDescriptor(d,C);if(typeof L.value=="function"&&(d[C]=d[C].bind(this)),L.set&&Object.defineProperty(d,C,{set:L.set.bind(this)}),L.get&&Object.defineProperty(d,C,{get:L.get.bind(this)}),So.has(C)){let G=C==="add"?()=>{u=a(I=>A.push(I),"onCurCompCleanup"),d[C](),u=null}:d[C];A.push(this.on(C,G).cancel)}else if(this[C]===void 0)Object.defineProperty(this,C,{get:()=>d[C],set:G=>d[C]=G,configurable:!0,enumerable:!0}),A.push(()=>delete this[C]);else throw new k(`Duplicate component property: "${C}"`)}let R=a(()=>{if(d.require){for(let C of d.require)if(!this.c(C))throw new k(`Component "${d.id}" requires component "${C}"`)}},"checkDeps");d.destroy&&A.push(d.destroy.bind(this)),this.exists()?(R(),d.add&&(u=a(C=>A.push(C),"onCurCompCleanup"),d.add.call(this),u=null)):d.require&&A.push(this.on("add",R).cancel)},unuse(d){s[d]&&(s[d].forEach(A=>A()),delete s[d]),i.has(d)&&i.delete(d)},c(d){return i.get(d)},get(d,A={}){let R=A.recursive?this.children.flatMap(a(function C(L){return[L,...L.children.flatMap(C)]},"recurse")):this.children;if(R=R.filter(C=>d?C.is(d):!0),A.liveUpdate){let C=a(G=>A.recursive?this.isAncestorOf(G):G.parent===this,"isChild"),L=[];L.push(cn(G=>{C(G)&&G.is(d)&&R.push(G)})),L.push(Hn(G=>{if(C(G)&&G.is(d)){let I=R.findIndex(N=>N.id===G.id);I!==-1&&R.splice(I,1)}})),this.onDestroy(()=>{for(let G of L)G.cancel()})}return R},isAncestorOf(d){return d.parent?d.parent===this||this.isAncestorOf(d.parent):!1},exists(){return T.root.isAncestorOf(this)},is(d){if(d==="*")return!0;if(Array.isArray(d)){for(let A of d)if(!this.c(A))return!1;return!0}else return this.c(d)!=null},on(d,A){let R=r.on(d,A.bind(this));return u&&u(()=>R.cancel()),R},trigger(d,...A){r.trigger(d,...A),T.objEvents.trigger(d,this,...A)},destroy(){this.parent&&this.parent.remove(this)},inspect(){let d={};for(let[A,R]of i)d[A]=R.inspect?R.inspect():null;return d},onAdd(d){return this.on("add",d)},onUpdate(d){return this.on("update",d)},onDraw(d){return this.on("draw",d)},onDestroy(d){return this.on("destroy",d)},clearEvents(){r.clear()}},m=["onKeyPress","onKeyPressRepeat","onKeyDown","onKeyRelease","onMousePress","onMouseDown","onMouseRelease","onMouseMove","onCharInput","onMouseMove","onTouchStart","onTouchMove","onTouchEnd","onScroll","onGamepadButtonPress","onGamepadButtonDown","onGamepadButtonRelease","onGamepadStick"];for(let d of m)w[d]=(...A)=>{let R=x[d](...A);return o.push(R),w.onDestroy(()=>R.cancel()),R};for(let d of e)w.use(d);return w}a(dn,"make");function Le(e,i,s){return T.objEvents[e]||(T.objEvents[e]=new cr),T.objEvents.on(e,(r,...o)=>{r.is(i)&&s(r,...o)})}a(Le,"on");let Gn=a((e,i)=>{if(typeof e=="function"&&i===void 0){let s=$t([{update:e}]);return{get paused(){return s.paused},set paused(r){s.paused=r},cancel:()=>s.destroy()}}else if(typeof e=="string")return Le("update",e,i)},"onUpdate"),jr=a((e,i)=>{if(typeof e=="function"&&i===void 0){let s=$t([{draw:e}]);return{get paused(){return s.hidden},set paused(r){s.hidden=r},cancel:()=>s.destroy()}}else if(typeof e=="string")return Le("draw",e,i)},"onDraw");function cn(e,i){if(typeof e=="function"&&i===void 0)return T.events.on("add",e);if(typeof e=="string")return Le("add",e,i)}a(cn,"onAdd");function Hn(e,i){if(typeof e=="function"&&i===void 0)return T.events.on("destroy",e);if(typeof e=="string")return Le("destroy",e,i)}a(Hn,"onDestroy");function Ii(e,i,s){return Le("collide",e,(r,o,u)=>o.is(i)&&s(r,o,u))}a(Ii,"onCollide");function Ui(e,i,s){return Le("collideUpdate",e,(r,o,u)=>o.is(i)&&s(r,o,u))}a(Ui,"onCollideUpdate");function Li(e,i,s){return Le("collideEnd",e,(r,o,u)=>o.is(i)&&s(r,o,u))}a(Li,"onCollideEnd");function zt(e,i){Xn(e,{recursive:!0}).forEach(i),cn(e,i)}a(zt,"forAllCurrentAndFuture");function Ni(e,i){if(typeof e=="function")return x.onMousePress(e);{let s=[];return zt(e,r=>{if(!r.area)throw new k("onClick() requires the object to have area() component");s.push(r.onClick(()=>i(r)))}),Rt.join(s)}}a(Ni,"onClick");function Oi(e,i){let s=[];return zt(e,r=>{if(!r.area)throw new k("onHover() requires the object to have area() component");s.push(r.onHover(()=>i(r)))}),Rt.join(s)}a(Oi,"onHover");function Gi(e,i){let s=[];return zt(e,r=>{if(!r.area)throw new k("onHoverUpdate() requires the object to have area() component");s.push(r.onHoverUpdate(()=>i(r)))}),Rt.join(s)}a(Gi,"onHoverUpdate");function Hi(e,i){let s=[];return zt(e,r=>{if(!r.area)throw new k("onHoverEnd() requires the object to have area() component");s.push(r.onHoverEnd(()=>i(r)))}),Rt.join(s)}a(Hi,"onHoverEnd");function Qt(e,i){let s=0,r=[];i&&r.push(i);let o=Gn(()=>{s+=Ee(),s>=e&&(o.cancel(),r.forEach(u=>u()))});return{paused:o.paused,cancel:o.cancel,onEnd(u){r.push(u)},then(u){return this.onEnd(u),this}}}a(Qt,"wait");function ji(e,i){let s=null,r=a(()=>{s=Qt(e,r),i()},"newAction");return s=Qt(0,r),{get paused(){return s.paused},set paused(o){s.paused=o},cancel:()=>s.cancel()}}a(ji,"loop");function qi(){x.onKeyPress("f1",()=>{ne.inspect=!ne.inspect}),x.onKeyPress("f2",()=>{ne.clearLog()}),x.onKeyPress("f8",()=>{ne.paused=!ne.paused}),x.onKeyPress("f7",()=>{ne.timeScale=Et(Ge(ne.timeScale-.2,0,2),1)}),x.onKeyPress("f9",()=>{ne.timeScale=Et(Ge(ne.timeScale+.2,0,2),1)}),x.onKeyPress("f10",()=>{ne.stepFrame()})}a(qi,"enterDebugMode");function Ki(){x.onKeyPress("b",()=>vt())}a(Ki,"enterBurpMode");function Yi(e){T.gravity=e}a(Yi,"setGravity");function Wi(){return T.gravity}a(Wi,"getGravity");function Xi(...e){e.length===1||e.length===2?(v.bgColor=Z(e[0]),e[1]&&(v.bgAlpha=e[1])):(e.length===3||e.length===4)&&(v.bgColor=Z(e[0],e[1],e[2]),e[3]&&(v.bgAlpha=e[3])),c.clearColor(v.bgColor.r/255,v.bgColor.g/255,v.bgColor.b/255,v.bgAlpha)}a(Xi,"setBackground");function zi(){return v.bgColor.clone()}a(zi,"getBackground");function Jt(...e){return{id:"pos",pos:B(...e),moveBy(...i){this.pos=this.pos.add(B(...i))},move(...i){this.moveBy(B(...i).scale(Ee()))},moveTo(...i){if(typeof i[0]=="number"&&typeof i[1]=="number")return this.moveTo(B(i[0],i[1]),i[2]);let s=i[0],r=i[1];if(r===void 0){this.pos=B(s);return}let o=s.sub(this.pos);if(o.len()<=r*Ee()){this.pos=B(s);return}this.move(o.unit().scale(r))},worldPos(){return this.parent?this.parent.transform.multVec2(this.pos):this.pos},screenPos(){let i=this.worldPos();return St(this)?i:Nn(i)},inspect(){return`(${Math.round(this.pos.x)}, ${Math.round(this.pos.y)})`},drawInspect(){$e({color:Z(255,0,0),radius:4/Dn()})}}}a(Jt,"pos");function Zt(...e){return e.length===0?Zt(1):{id:"scale",scale:B(...e),scaleTo(...i){this.scale=B(...i)},scaleBy(...i){this.scale.scale(B(...i))},inspect(){return`(${Et(this.scale.x,2)}, ${Et(this.scale.y,2)})`}}}a(Zt,"scale");function Qi(e){return{id:"rotate",angle:e??0,rotateBy(i){this.angle+=i},rotateTo(i){this.angle=i},inspect(){return`${Math.round(this.angle)}`}}}a(Qi,"rotate");function Ji(...e){return{id:"color",color:Z(...e),inspect(){return this.color.toString()}}}a(Ji,"color");function Et(e,i){return Number(e.toFixed(i))}a(Et,"toFixed");function Zi(e){return{id:"opacity",opacity:e??1,inspect(){return`${Et(this.opacity,1)}`},fadeOut(i=1,s=tn.linear){return wn(this.opacity,0,i,r=>this.opacity=r,s)}}}a(Zi,"opacity");function pn(e){if(!e)throw new k("Please define an anchor");return{id:"anchor",anchor:e,inspect(){return typeof this.anchor=="string"?this.anchor:this.anchor.toString()}}}a(pn,"anchor");function _i(e){return{id:"z",z:e,inspect(){return`${this.z}`}}}a(_i,"z");function $i(e,i){return{id:"follow",require:["pos"],follow:{obj:e,offset:i??B(0)},add(){e.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))},update(){e.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))}}}a($i,"follow");function es(e,i){let s=typeof e=="number"?E.fromAngle(e):e.unit();return{id:"move",require:["pos"],update(){this.move(s.scale(i))}}}a(es,"move");let qr=200;function ts(e={}){let i=e.distance??qr,s=!1;return{id:"offscreen",require:["pos"],isOffScreen(){let r=this.screenPos(),o=new Ve(B(0),Ae(),ve());return!rn(o,r)&&o.sdistToPoint(r)>i*i},onExitScreen(r){return this.on("exitView",r)},onEnterScreen(r){return this.on("enterView",r)},update(){this.isOffScreen()?(s||(this.trigger("exitView"),s=!0),e.hide&&(this.hidden=!0),e.pause&&(this.paused=!0),e.destroy&&this.destroy()):(s&&(this.trigger("enterView"),s=!1),e.hide&&(this.hidden=!1),e.pause&&(this.paused=!1))}}}a(ts,"offscreen");function St(e){return e.fixed?!0:e.parent?St(e.parent):!1}a(St,"isFixed");function ns(e={}){let i={},s=new Set;return{id:"area",collisionIgnore:e.collisionIgnore??[],add(){this.area.cursor&&this.onHover(()=>x.setCursor(this.area.cursor)),this.onCollideUpdate((r,o)=>{i[r.id]||this.trigger("collide",r,o),i[r.id]=o,s.add(r.id)})},update(){for(let r in i)s.has(Number(r))||(this.trigger("collideEnd",i[r].target),delete i[r]);s.clear()},drawInspect(){let r=this.localArea();O(),S(this.area.scale),V(this.area.offset);let o={outline:{width:4/Dn(),color:Z(0,0,255)},anchor:this.anchor,fill:!1,fixed:St(this)};r instanceof Ve?ce({...o,pos:r.pos,width:r.width,height:r.height}):r instanceof xn?Ke({...o,pts:r.pts}):r instanceof Ls&&$e({...o,pos:r.center,radius:r.radius}),te()},area:{shape:e.shape??null,scale:e.scale?B(e.scale):B(1),offset:e.offset??B(0),cursor:e.cursor??null},isClicked(){return x.isMousePressed()&&this.isHovering()},isHovering(){let r=St(this)?Wt():On(Wt());return this.hasPoint(r)},checkCollision(r){return i[r.id]??null},getCollisions(){return Object.values(i)},isColliding(r){return!!i[r.id]},isOverlapping(r){let o=i[r.id];return o&&o.hasOverlap()},onClick(r){let o=x.onMousePress("left",()=>{this.isHovering()&&r()});return this.onDestroy(()=>o.cancel()),o},onHover(r){let o=!1;return this.onUpdate(()=>{o?o=this.isHovering():this.isHovering()&&(o=!0,r())})},onHoverUpdate(r){return this.onUpdate(()=>{this.isHovering()&&r()})},onHoverEnd(r){let o=!1;return this.onUpdate(()=>{o?this.isHovering()||(o=!1,r()):o=this.isHovering()})},onCollide(r,o){if(typeof r=="function"&&o===void 0)return this.on("collide",r);if(typeof r=="string")return this.onCollide((u,g)=>{u.is(r)&&o(u,g)})},onCollideUpdate(r,o){if(typeof r=="function"&&o===void 0)return this.on("collideUpdate",r);if(typeof r=="string")return this.on("collideUpdate",(u,g)=>u.is(r)&&o(u,g))},onCollideEnd(r,o){if(typeof r=="function"&&o===void 0)return this.on("collideEnd",r);if(typeof r=="string")return this.on("collideEnd",u=>u.is(r)&&o(u))},hasPoint(r){return wi(this.worldArea(),r)},resolveCollision(r){let o=this.checkCollision(r);o&&!o.resolved&&(this.pos=this.pos.add(o.displacement),o.resolved=!0)},localArea(){return this.area.shape?this.area.shape:this.renderArea()},worldArea(){let r=this.localArea();if(!(r instanceof xn||r instanceof Ve))throw new k("Only support polygon and rect shapes for now");let o=this.transform.clone().scale(B(this.area.scale??1)).translate(this.area.offset);if(r instanceof Ve){let u=it(this.anchor||Vn).add(1,1).scale(-.5).scale(r.width,r.height);o.translate(u)}return r.transform(o)},screenArea(){let r=this.worldArea();return St(this)?r:r.transform(T.cam.transform)}}}a(ns,"area");function et(e){return{color:e.color,opacity:e.opacity,anchor:e.anchor,outline:e.outline,shader:e.shader,uniform:e.uniform}}a(et,"getRenderProps");function fn(e,i={}){let s=null,r=null,o=null,u=new Be;if(!e)throw new k("Please pass the resource name or data to sprite()");let g=a((w,m,d,A)=>{let R=B(1,1);return d&&A?(R.x=d/(w.width*m.w),R.y=A/(w.height*m.h)):d?(R.x=d/(w.width*m.w),R.y=R.x):A&&(R.y=A/(w.height*m.h),R.x=R.y),R},"calcTexScale");return{id:"sprite",width:0,height:0,frame:i.frame||0,quad:i.quad||new me(0,0,1,1),animSpeed:i.animSpeed??1,flipX:i.flipX??!1,flipY:i.flipY??!1,draw(){if(!s)return;let w=s.frames[this.frame??0];if(!w)throw new k(`Frame not found: ${this.frame??0}`);if(s.slice9){let{left:m,right:d,top:A,bottom:R}=s.slice9,C=s.tex.width*w.w,L=s.tex.height*w.h,G=this.width-m-d,I=this.height-A-R,N=m/C,Se=d/C,X=1-N-Se,z=A/L,H=R/L,pe=1-z-H,b=[re(0,0,N,z),re(N,0,X,z),re(N+X,0,Se,z),re(0,z,N,pe),re(N,z,X,pe),re(N+X,z,Se,pe),re(0,z+pe,N,H),re(N,z+pe,X,H),re(N+X,z+pe,Se,H),re(0,0,m,A),re(m,0,G,A),re(m+G,0,d,A),re(0,A,m,I),re(m,A,G,I),re(m+G,A,d,I),re(0,A+I,m,R),re(m,A+I,G,R),re(m+G,A+I,d,R)];for(let F=0;F<9;F++){let D=b[F],U=b[F+9];_e(Object.assign(et(this),{pos:U.pos(),tex:s.tex,quad:w.scale(D),flipX:this.flipX,flipY:this.flipY,tiled:i.tiled,width:U.w,height:U.h}))}}else _e(Object.assign(et(this),{tex:s.tex,quad:w.scale(this.quad??new me(0,0,1,1)),flipX:this.flipX,flipY:this.flipY,tiled:i.tiled,width:this.width,height:this.height}))},add(){let w=a(d=>{let A=d.frames[0].clone();i.quad&&(A=A.scale(i.quad));let R=g(d.tex,A,i.width,i.height);this.width=d.tex.width*A.w*R.x,this.height=d.tex.height*A.h*R.y,i.anim&&this.play(i.anim),s=d,u.trigger(s)},"setSpriteData"),m=Ze(e);m?m.onLoad(w):mn(()=>w(Ze(e).data))},update(){if(!r)return;let w=s.anims[r.name];if(typeof w=="number"){this.frame=w;return}if(w.speed===0)throw new k("Sprite anim speed cannot be 0");r.timer+=Ee()*this.animSpeed,r.timer>=1/r.speed&&(r.timer=0,this.frame+=o,(this.frame<Math.min(w.from,w.to)||this.frame>Math.max(w.from,w.to))&&(r.loop?r.pingpong?(this.frame-=o,o*=-1,this.frame+=o):this.frame=w.from:(this.frame=w.to,r.onEnd(),this.stop())))},play(w,m={}){if(!s){u.add(()=>this.play(w,m));return}let d=s.anims[w];if(d===void 0)throw new k(`Anim not found: ${w}`);r&&this.stop(),r=typeof d=="number"?{name:w,timer:0,loop:!1,pingpong:!1,speed:0,onEnd:()=>{}}:{name:w,timer:0,loop:m.loop??d.loop??!1,pingpong:m.pingpong??d.pingpong??!1,speed:m.speed??d.speed??10,onEnd:m.onEnd??(()=>{})},o=typeof d=="number"?null:d.from<d.to?1:-1,this.frame=typeof d=="number"?d:d.from,this.trigger("animStart",w)},stop(){if(!r)return;let w=r.name;r=null,this.trigger("animEnd",w)},numFrames(){return s?.frames.length??0},curAnim(){return r?.name},onAnimEnd(w){return this.on("animEnd",w)},onAnimStart(w){return this.on("animStart",w)},renderArea(){return new Ve(B(0),this.width,this.height)},inspect(){if(typeof e=="string")return`"${e}"`}}}a(fn,"sprite");function is(e,i={}){function s(o){let u=Ye(Object.assign(et(o),{text:o.text+"",size:o.textSize,font:o.font,width:i.width&&o.width,align:o.align,letterSpacing:o.letterSpacing,lineSpacing:o.lineSpacing,transform:o.textTransform,styles:o.textStyles}));return i.width||(o.width=u.width/(o.scale?.x||1)),o.height=u.height/(o.scale?.y||1),u}a(s,"update");let r={id:"text",set text(o){e=o,s(this)},get text(){return e},textSize:i.size??Ao,font:i.font,width:i.width??0,height:0,align:i.align,lineSpacing:i.lineSpacing,letterSpacing:i.letterSpacing,textTransform:i.transform,textStyles:i.styles,add(){mn(()=>s(this))},draw(){We(s(this))},renderArea(){return new Ve(B(0),this.width,this.height)}};return s(r),r}a(is,"text");function ss(e,i,s={}){return{id:"rect",width:e,height:i,radius:s.radius||0,draw(){ce(Object.assign(et(this),{width:this.width,height:this.height,radius:this.radius,fill:s.fill}))},renderArea(){return new Ve(B(0),this.width,this.height)},inspect(){return`${Math.ceil(this.width)}, ${Math.ceil(this.height)}`}}}a(ss,"rect");function rs(e,i){return{id:"rect",width:e,height:i,draw(){de(Object.assign(et(this),{width:this.width,height:this.height}))},renderArea(){return new Ve(B(0),this.width,this.height)},inspect(){return`${Math.ceil(this.width)}, ${Math.ceil(this.height)}`}}}a(rs,"uvquad");function os(e,i={}){return{id:"circle",radius:e,draw(){$e(Object.assign(et(this),{radius:this.radius,fill:i.fill}))},renderArea(){return new Ve(new E(this.anchor?0:-this.radius),this.radius*2,this.radius*2)},inspect(){return`${Math.ceil(this.radius)}`}}}a(os,"circle");function as(e=1,i=Z(0,0,0)){return{id:"outline",outline:{width:e,color:i}}}a(as,"outline");function jn(){return{id:"timer",wait(e,i){let s=[];i&&s.push(i);let r=0,o=this.onUpdate(()=>{r+=Ee(),r>=e&&(s.forEach(u=>u()),o.cancel())});return{get paused(){return o.paused},set paused(u){o.paused=u},cancel:o.cancel,onEnd(u){s.push(u)},then(u){return this.onEnd(u),this}}},loop(e,i){let s=null,r=a(()=>{s=this.wait(e,r),i()},"newAction");return s=this.wait(0,r),{get paused(){return s.paused},set paused(o){s.paused=o},cancel:()=>s.cancel()}},tween(e,i,s,r,o=tn.linear){let u=0,g=[],w=this.onUpdate(()=>{u+=Ee();let m=Math.min(u/s,1);r(Ce(e,i,o(m))),m===1&&(w.cancel(),r(i),g.forEach(d=>d()))});return{get paused(){return w.paused},set paused(m){w.paused=m},onEnd(m){g.push(m)},then(m){return this.onEnd(m),this},cancel(){w.cancel()},finish(){w.cancel(),r(i),g.forEach(m=>m())}}}}}a(jn,"timer");let Kr=640,Yr=65536;function ls(e={}){let i=B(0),s=null,r=null,o=!1;return{id:"body",require:["pos","area"],jumpForce:e.jumpForce??Kr,gravityScale:e.gravityScale??1,isStatic:e.isStatic??!1,mass:e.mass??1,add(){if(this.mass===0)throw new k("Can't set body mass to 0");this.onCollideUpdate((u,g)=>{if(u.is("body")&&!g.resolved&&(this.trigger("beforePhysicsResolve",g),u.trigger("beforePhysicsResolve",g.reverse()),!g.resolved&&!(this.isStatic&&u.isStatic))){if(!this.isStatic&&!u.isStatic){let w=this.mass+u.mass;this.pos=this.pos.add(g.displacement.scale(u.mass/w)),u.pos=u.pos.add(g.displacement.scale(-this.mass/w)),this.transform=Xt(this),u.transform=Xt(u)}else{let w=!this.isStatic&&u.isStatic?g:g.reverse();w.source.pos=w.source.pos.add(w.displacement),w.source.transform=Xt(w.source)}g.resolved=!0,this.trigger("physicsResolve",g),u.trigger("physicsResolve",g.reverse())}}),this.onPhysicsResolve(u=>{T.gravity&&(u.isBottom()&&this.isFalling()?(i.y=0,s=u.target,r=u.target.pos,o?o=!1:this.trigger("ground",s)):u.isTop()&&this.isJumping()&&(i.y=0,this.trigger("headbutt",u.target)))})},update(){if(!T.gravity||this.isStatic)return;if(o&&(s=null,r=null,this.trigger("fallOff"),o=!1),s)if(!this.isOverlapping(s)||!s.exists()||!s.is("body"))o=!0;else{!s.pos.eq(r)&&e.stickToPlatform!==!1&&this.moveBy(s.pos.sub(r)),r=s.pos;return}let u=i.y;i.y+=T.gravity*this.gravityScale*Ee(),i.y=Math.min(i.y,e.maxVelocity??Yr),u<0&&i.y>=0&&this.trigger("fall"),this.move(i)},onPhysicsResolve(u){return this.on("physicsResolve",u)},onBeforePhysicsResolve(u){return this.on("beforePhysicsResolve",u)},curPlatform(){return s},isGrounded(){return s!==null},isFalling(){return i.y>0},isJumping(){return i.y<0},jump(u){s=null,r=null,i.y=-u||-this.jumpForce},onGround(u){return this.on("ground",u)},onFall(u){return this.on("fall",u)},onFallOff(u){return this.on("fallOff",u)},onHeadbutt(u){return this.on("headbutt",u)}}}a(ls,"body");function hs(e=2){let i=e;return{id:"doubleJump",require:["body"],numJumps:e,add(){this.onGround(()=>{i=this.numJumps})},doubleJump(s){i<=0||(i<this.numJumps&&this.trigger("doubleJump"),i--,this.jump(s))},onDoubleJump(s){return this.on("doubleJump",s)},inspect(){return`${i}`}}}a(hs,"doubleJump");function us(e,i){return{id:"shader",shader:e,...typeof i=="function"?{uniform:i(),update(){this.uniform=i()}}:{uniform:i}}}a(us,"shader");function ds(){return{id:"fixed",fixed:!0}}a(ds,"fixed");function qn(e){return{id:"stay",stay:!0,scenesToStay:e}}a(qn,"stay");function cs(e){if(e==null)throw new k("health() requires the initial amount of hp");let i=e;return{id:"health",hurt(s=1){this.setHP(e-s),this.trigger("hurt",s)},heal(s=1){this.setHP(e+s),this.trigger("heal",s)},hp(){return e},maxHP(){return i},setHP(s){e=s,e<=0&&this.trigger("death")},onHurt(s){return this.on("hurt",s)},onHeal(s){return this.on("heal",s)},onDeath(s){return this.on("death",s)},inspect(){return`${e}`}}}a(cs,"health");function ps(e,i={}){if(e==null)throw new k("lifespan() requires time");let s=i.fade??0;return{id:"lifespan",async add(){await Qt(e),s>0&&this.opacity&&await wn(this.opacity,0,s,r=>this.opacity=r,tn.linear),this.destroy()}}}a(ps,"lifespan");function fs(e,i,s){if(!e)throw new k("state() requires an initial state");let r={};function o(m){r[m]||(r[m]={enter:new Be,end:new Be,update:new Be,draw:new Be})}a(o,"initStateEvents");function u(m,d,A){return o(d),r[d][m].add(A)}a(u,"on");function g(m,d,...A){o(d),r[d][m].trigger(...A)}a(g,"trigger");let w=!1;return{id:"state",state:e,enterState(m,...d){if(w=!0,i&&!i.includes(m))throw new k(`State not found: ${m}`);let A=this.state;if(s){if(!s?.[A])return;let R=typeof s[A]=="string"?[s[A]]:s[A];if(!R.includes(m))throw new k(`Cannot transition state from "${A}" to "${m}". Available transitions: ${R.map(C=>`"${C}"`).join(", ")}`)}g("end",A,...d),this.state=m,g("enter",m,...d),g("enter",`${A} -> ${m}`,...d)},onStateTransition(m,d,A){return u("enter",`${m} -> ${d}`,A)},onStateEnter(m,d){return u("enter",m,d)},onStateUpdate(m,d){return u("update",m,d)},onStateDraw(m,d){return u("draw",m,d)},onStateEnd(m,d){return u("end",m,d)},update(){w||(g("enter",e),w=!0),g("update",this.state)},draw(){g("draw",this.state)},inspect(){return this.state}}}a(fs,"state");function ms(e=1){let i=0,s=!1;return{require:["opacity"],add(){this.opacity=0},update(){s||(i+=Ee(),this.opacity=Xe(i,0,e,0,1),i>=e&&(this.opacity=1,s=!0))}}}a(ms,"fadeIn");function gs(e="intersect"){return{id:"mask",mask:e}}a(gs,"mask");function mn(e){K.loaded?e():T.events.on("load",e)}a(mn,"onLoad");function ws(e,i){T.scenes[e]=i}a(ws,"scene");function As(e,...i){if(!T.scenes[e])throw new k(`Scene not found: ${e}`);T.events.onOnce("frameEnd",()=>{T.events.trigger("sceneLeave",e),x.events.clear(),T.events.clear(),T.objEvents.clear(),[...T.root.children].forEach(s=>{(!s.stay||s.scenesToStay&&!s.scenesToStay.includes(e))&&T.root.remove(s)}),T.root.clearEvents(),$n(),T.cam={pos:null,scale:B(1),angle:0,shake:0,transform:new Pe},T.scenes[e](...i)})}a(As,"go");function vs(e){return T.events.on("sceneLeave",e)}a(vs,"onSceneLeave");function Vs(e,i){try{return JSON.parse(window.localStorage[e])}catch{return i?(Kn(e,i),i):null}}a(Vs,"getData");function Kn(e,i){window.localStorage[e]=JSON.stringify(i)}a(Kn,"setData");function Yn(e,...i){let s=e(tt),r;typeof s=="function"?r=s(...i)(tt):r=s;for(let o in r)tt[o]=r[o],n.global!==!1&&(window[o]=r[o]);return tt}a(Yn,"plug");function _t(){return B(Ae()/2,ve()/2)}a(_t,"center");let Wr;(e=>(e[e.None=0]="None",e[e.Left=1]="Left",e[e.Top=2]="Top",e[e.LeftTop=3]="LeftTop",e[e.Right=4]="Right",e[e.Horizontal=5]="Horizontal",e[e.RightTop=6]="RightTop",e[e.HorizontalTop=7]="HorizontalTop",e[e.Bottom=8]="Bottom",e[e.LeftBottom=9]="LeftBottom",e[e.Vertical=10]="Vertical",e[e.LeftVertical=11]="LeftVertical",e[e.RightBottom=12]="RightBottom",e[e.HorizontalBottom=13]="HorizontalBottom",e[e.RightVertical=14]="RightVertical",e[e.All=15]="All"))(Wr||={});function Wn(e={}){let i=B(0),s=e.isObstacle??!1,r=e.cost??0,o=e.edges??[],u=a(()=>{let w={left:1,top:2,right:4,bottom:8};return o.map(m=>w[m]||0).reduce((m,d)=>m|d,0)},"getEdgeMask"),g=u();return{id:"tile",tilePosOffset:e.offset??B(0),set tilePos(w){let m=this.getLevel();i=w.clone(),this.pos=B(this.tilePos.x*m.tileWidth(),this.tilePos.y*m.tileHeight()).add(this.tilePosOffset)},get tilePos(){return i},set isObstacle(w){s!==w&&(s=w,this.getLevel().invalidateNavigationMap())},get isObstacle(){return s},set cost(w){r!==w&&(r=w,this.getLevel().invalidateNavigationMap())},get cost(){return r},set edges(w){o=w,g=u(),this.getLevel().invalidateNavigationMap()},get edges(){return o},get edgeMask(){return g},getLevel(){return this.parent},moveLeft(){this.tilePos=this.tilePos.add(B(-1,0))},moveRight(){this.tilePos=this.tilePos.add(B(1,0))},moveUp(){this.tilePos=this.tilePos.add(B(0,-1))},moveDown(){this.tilePos=this.tilePos.add(B(0,1))}}}a(Wn,"tile");function ys(e,i){if(!i.tileWidth||!i.tileHeight)throw new k("Must provide tileWidth and tileHeight.");let s=$t([Jt(i.pos??B(0))]),r=e.length,o=0,u=null,g=null,w=null,m=null,d=a(b=>b.x+b.y*o,"tile2Hash"),A=a(b=>B(Math.floor(b%o),Math.floor(b/o)),"hash2Tile"),R=a(()=>{u=[];for(let b of s.children)C(b)},"createSpatialMap"),C=a(b=>{let F=d(b.tilePos);u[F]?u[F].push(b):u[F]=[b]},"insertIntoSpatialMap"),L=a(b=>{let F=d(b.tilePos);if(u[F]){let D=u[F].indexOf(b);D>=0&&u[F].splice(D,1)}},"removeFromSpatialMap"),G=a(()=>{let b=!1;for(let F of s.children){let D=s.pos2Tile(F.pos);(F.tilePos.x!=D.x||F.tilePos.y!=D.y)&&(b=!0,L(F),F.tilePos.x=D.x,F.tilePos.y=D.y,C(F))}b&&s.trigger("spatial_map_changed")},"updateSpatialMap"),I=a(()=>{let b=s.getSpatialMap(),F=s.numRows()*s.numColumns();g?g.length=F:g=new Array(F),g.fill(1,0,F);for(let D=0;D<b.length;D++){let U=b[D];if(U){let Q=0;for(let J of U)if(J.isObstacle){Q=1/0;break}else Q+=J.cost;g[D]=Q||1}}},"createCostMap"),N=a(()=>{let b=s.getSpatialMap(),F=s.numRows()*s.numColumns();w?w.length=F:w=new Array(F),w.fill(15,0,F);for(let D=0;D<b.length;D++){let U=b[D];if(U){let Q=U.length,J=15;for(let se=0;se<Q;se++)J|=U[se].edgeMask;w[D]=J}}},"createEdgeMap"),Se=a(()=>{let b=s.numRows()*s.numColumns(),F=a((U,Q)=>{let J=[];for(J.push(U);J.length>0;){let se=J.pop();H(se).forEach(fe=>{m[fe]<0&&(m[fe]=Q,J.push(fe))})}},"traverse");m?m.length=b:m=new Array(b),m.fill(-1,0,b);let D=0;for(let U=0;U<g.length;U++){if(m[U]>=0){D++;continue}F(U,D),D++}},"createConnectivityMap"),X=a((b,F)=>g[F],"getCost"),z=a((b,F)=>{let D=A(b),U=A(F);return D.dist(U)},"getHeuristic"),H=a((b,F)=>{let D=[],U=Math.floor(b%o),Q=U>0&&w[b]&1&&g[b-1]!==1/0,J=b>=o&&w[b]&2&&g[b-o]!==1/0,se=U<o-1&&w[b]&4&&g[b+1]!==1/0,fe=b<o*r-o-1&&w[b]&8&&g[b+o]!==1/0;return F?(Q&&(J&&D.push(b-o-1),D.push(b-1),fe&&D.push(b+o-1)),J&&D.push(b-o),se&&(J&&D.push(b-o+1),D.push(b+1),fe&&D.push(b+o+1)),fe&&D.push(b+o)):(Q&&D.push(b-1),J&&D.push(b-o),se&&D.push(b+1),fe&&D.push(b+o)),D},"getNeighbours"),pe={id:"level",tileWidth(){return i.tileWidth},tileHeight(){return i.tileHeight},spawn(b,...F){let D=B(...F),U=(()=>{if(typeof b=="string"){if(i.tiles[b]){if(typeof i.tiles[b]!="function")throw new k("Level symbol def must be a function returning a component list");return i.tiles[b](D)}else if(i.wildcardTile)return i.wildcardTile(b,D)}else{if(Array.isArray(b))return b;throw new k("Expected a symbol or a component list")}})();if(!U)return null;let Q=!1,J=!1;for(let fe of U)fe.id==="tile"&&(J=!0),fe.id==="pos"&&(Q=!0);Q||U.push(Jt()),J||U.push(Wn());let se=s.add(U);return Q&&(se.tilePosOffset=se.pos.clone()),se.tilePos=D,u&&(C(se),this.trigger("spatial_map_changed"),this.trigger("navigation_map_invalid")),se},numColumns(){return o},numRows(){return r},levelWidth(){return o*this.tileWidth()},levelHeight(){return r*this.tileHeight()},tile2Pos(...b){return B(...b).scale(this.tileWidth(),this.tileHeight())},pos2Tile(...b){let F=B(...b);return B(Math.floor(F.x/this.tileWidth()),Math.floor(F.y/this.tileHeight()))},getSpatialMap(){return u||R(),u},onSpatialMapChanged(b){return this.on("spatial_map_changed",b)},onNavigationMapInvalid(b){return this.on("navigation_map_invalid",b)},getAt(b){u||R();let F=d(b);return u[F]||[]},update(){u&&G()},invalidateNavigationMap(){g=null,w=null,m=null},onNavigationMapChanged(b){return this.on("navigation_map_changed",b)},getTilePath(b,F,D={}){if(g||I(),w||N(),m||Se(),b.x<0||b.x>=o||b.y<0||b.y>=r||F.x<0||F.x>=o||F.y<0||F.y>=r)return null;let U=d(b),Q=d(F);if(g[Q]===1/0)return null;if(U===Q)return[];if(m[U]!=-1&&m[U]!==m[Q])return null;let J=new oo((Ne,ti)=>Ne.cost<ti.cost);J.insert({cost:0,node:U});let se=new Map;se.set(U,U);let fe=new Map;for(fe.set(U,0);J.length!==0;){let Ne=J.remove()?.node;if(Ne===Q)break;let ti=H(Ne,D.allowDiagonals);for(let nt of ti){let ni=(fe.get(Ne)||0)+X(Ne,nt)+z(nt,Q);(!fe.has(nt)||ni<fe.get(nt))&&(fe.set(nt,ni),J.insert({cost:ni,node:nt}),se.set(nt,Ne))}}let ei=[],en=Q,Zr=A(en);for(ei.push(Zr);en!==U;){en=se.get(en);let Ne=A(en);ei.push(Ne)}return ei.reverse()},getPath(b,F,D={}){let U=this.tileWidth(),Q=this.tileHeight(),J=this.getTilePath(this.pos2Tile(b),this.pos2Tile(F),D);return J?[b,...J.slice(1,-1).map(se=>se.scale(U,Q).add(U/2,Q/2)),F]:null}};return s.use(pe),s.onNavigationMapInvalid(()=>{s.invalidateNavigationMap(),s.trigger("navigation_map_changed")}),e.forEach((b,F)=>{let D=b.split("");o=Math.max(D.length,o),D.forEach((U,Q)=>{s.spawn(U,B(Q,F))})}),s}a(ys,"addLevel");function xs(e={}){let i=null,s=null,r=null,o=null;return{id:"agent",require:["pos","tile"],agentSpeed:e.speed??100,allowDiagonals:e.allowDiagonals??!0,getDistanceToTarget(){return i?this.pos.dist(i):0},getNextLocation(){return s&&r?s[r]:null},getPath(){return s?s.slice():null},getTarget(){return i},isNavigationFinished(){return s?r===null:!0},isTargetReachable(){return s!==null},isTargetReached(){return i?this.pos.eq(i):!0},setTarget(u){i=u,s=this.getLevel().getPath(this.pos,i,{allowDiagonals:this.allowDiagonals}),r=s?0:null,s?(o||(o=this.getLevel().onNavigationMapChanged(()=>{s&&r!==null&&(s=this.getLevel().getPath(this.pos,i,{allowDiagonals:this.allowDiagonals}),r=s?0:null,s?this.trigger("navigation-next",this,s[r]):this.trigger("navigation-ended",this))}),this.onDestroy(()=>o.cancel())),this.trigger("navigation-started",this),this.trigger("navigation-next",this,s[r])):this.trigger("navigation-ended",this)},update(){if(s&&r!==null){if(this.pos.sdist(s[r])<2)if(r===s.length-1){this.pos=i.clone(),r=null,this.trigger("navigation-ended",this),this.trigger("target-reached",this);return}else r++,this.trigger("navigation-next",this,s[r]);this.moveTo(s[r],this.agentSpeed)}},onNavigationStarted(u){return this.on("navigation-started",u)},onNavigationNext(u){return this.on("navigation-next",u)},onNavigationEnded(u){return this.on("navigation-ended",u)},onTargetReached(u){return this.on("target-reached",u)},inspect(){return JSON.stringify({target:JSON.stringify(i),path:JSON.stringify(s)})}}}a(xs,"agent");function bs(e){let i=x.canvas().captureStream(e),s=ee.ctx.createMediaStreamDestination();ee.masterNode.connect(s);let r=new MediaRecorder(i),o=[];return r.ondataavailable=u=>{u.data.size>0&&o.push(u.data)},r.onerror=()=>{ee.masterNode.disconnect(s),i.getTracks().forEach(u=>u.stop())},r.start(),{resume(){r.resume()},pause(){r.pause()},stop(){return r.stop(),ee.masterNode.disconnect(s),i.getTracks().forEach(u=>u.stop()),new Promise(u=>{r.onstop=()=>{u(new Blob(o,{type:"video/mp4"}))}})},download(u="kaboom.mp4"){this.stop().then(g=>pi(u,g))}}}a(bs,"record");function Es(){return document.activeElement===x.canvas()}a(Es,"isFocused");function Ss(e){e.destroy()}a(Ss,"destroy");let $t=T.root.add.bind(T.root),Xr=T.root.readd.bind(T.root),zr=T.root.removeAll.bind(T.root),Xn=T.root.get.bind(T.root);function zn(e=2,i=1){let s=0;return{id:"boom",require:["scale"],update(){let r=Math.sin(s*e)*i;r<0&&this.destroy(),this.scale=B(r),s+=Ee()}}}a(zn,"boom");let Qr=Ie(null,fo),Jr=Ie(null,mo);function Rs(e,i={}){let s=$t([Jt(e),qn()]),r=(i.speed||1)*5,o=i.scale||1;s.add([fn(Jr),Zt(0),pn("center"),zn(r,o),...i.comps??[]]);let u=s.add([fn(Qr),Zt(0),pn("center"),jn(),...i.comps??[]]);return u.wait(.4/r,()=>u.use(zn(r,o))),u.onDestroy(()=>s.destroy()),s}a(Rs,"addKaboom");function Qn(){T.root.update()}a(Qn,"updateFrame");class Jn{static{a(this,"Collision")}source;target;displacement;resolved=!1;constructor(i,s,r,o=!1){this.source=i,this.target=s,this.displacement=r,this.resolved=o}reverse(){return new Jn(this.target,this.source,this.displacement.scale(-1),this.resolved)}hasOverlap(){return!this.displacement.isZero()}isLeft(){return this.displacement.x>0}isRight(){return this.displacement.x<0}isTop(){return this.displacement.y>0}isBottom(){return this.displacement.y<0}preventResolution(){this.resolved=!0}}function Ms(){let e={},i=n.hashGridSize||vo,s=new Pe,r=[];function o(u){if(r.push(s.clone()),u.pos&&s.translate(u.pos),u.scale&&s.scale(u.scale),u.angle&&s.rotate(u.angle),u.transform=s.clone(),u.c("area")&&!u.paused){let g=u,w=g.worldArea().bbox(),m=Math.floor(w.pos.x/i),d=Math.floor(w.pos.y/i),A=Math.ceil((w.pos.x+w.width)/i),R=Math.ceil((w.pos.y+w.height)/i),C=new Set;for(let L=m;L<=A;L++)for(let G=d;G<=R;G++)if(!e[L])e[L]={},e[L][G]=[g];else if(!e[L][G])e[L][G]=[g];else{let I=e[L][G];e:for(let N of I){if(N.paused||!N.exists()||C.has(N.id))continue;for(let X of g.collisionIgnore)if(N.is(X))continue e;for(let X of N.collisionIgnore)if(g.is(X))continue e;let Se=dr(g.worldArea(),N.worldArea());if(Se){let X=new Jn(g,N,Se);g.trigger("collideUpdate",N,X);let z=X.reverse();z.resolved=X.resolved,N.trigger("collideUpdate",g,z)}C.add(N.id)}I.push(g)}}u.children.forEach(o),s=r.pop()}a(o,"checkObj"),o(T.root)}a(Ms,"checkFrame");function Bs(){let e=T.cam,i=E.fromAngle(sn(0,360)).scale(e.shake);e.shake=Ce(e.shake,0,5*Ee()),e.transform=new Pe().translate(_t()).scale(e.scale).rotate(e.angle).translate((e.pos??_t()).scale(-1).add(i)),T.root.draw(),be()}a(Bs,"drawFrame");function Ps(){let e=Re();T.events.numListeners("loading")>0?T.events.trigger("loading",e):Ue(()=>{let i=Ae()/2,s=24,r=B(Ae()/2,ve()/2).sub(B(i/2,s/2));ce({pos:B(0),width:Ae(),height:ve(),color:Z(0,0,0)}),ce({pos:r,width:i,height:s,fill:!1,outline:{width:4}}),ce({pos:r,width:i*e,height:s})})}a(Ps,"drawLoadScreen");function Zn(e,i){Ue(()=>{let s=B(8);O(),V(e);let r=Ye({text:i,font:yn,size:16,pos:s,color:Z(255,255,255),fixed:!0}),o=r.width+s.x*2,u=r.height+s.x*2;e.x+o>=Ae()&&V(B(-o,0)),e.y+u>=ve()&&V(B(0,-u)),ce({width:o,height:u,color:Z(0,0,0),radius:4,opacity:.8,fixed:!0}),We(r),te()})}a(Zn,"drawInspectText");function Ts(){if(ne.inspect){let e=null;for(let i of T.root.get("*",{recursive:!0}))if(i.c("area")&&i.isHovering()){e=i;break}if(T.root.drawInspect(),e){let i=[],s=e.inspect();for(let r in s)s[r]?i.push(`${r}: ${s[r]}`):i.push(`${r}`);Zn(Pi(Wt()),i.join(`
`))}Zn(B(8),`FPS: ${ne.fps()}`)}ne.paused&&Ue(()=>{O(),V(Ae(),0),V(-8,8);let e=32;ce({width:e,height:e,anchor:"topright",color:Z(0,0,0),opacity:.8,radius:4,fixed:!0});for(let i=1;i<=2;i++)ce({width:4,height:e*.6,anchor:"center",pos:B(-e/3*i,e*.5),color:Z(255,255,255),radius:2,fixed:!0});te()}),ne.timeScale!==1&&Ue(()=>{O(),V(Ae(),ve()),V(-8,-8);let e=8,i=Ye({text:ne.timeScale.toFixed(1),font:yn,size:16,color:Z(255,255,255),pos:B(-e),anchor:"botright",fixed:!0});ce({width:i.width+e*2+e*4,height:i.height+e*2,anchor:"botright",color:Z(0,0,0),opacity:.8,radius:4,fixed:!0});for(let s=0;s<2;s++){let r=ne.timeScale<1;Pn({p1:B(-i.width-e*(r?2:3.5),-e),p2:B(-i.width-e*(r?2:3.5),-e-i.height),p3:B(-i.width-e*(r?3.5:2),-e-i.height/2),pos:B(-s*e*1+(r?-e*.5:0),0),color:Z(255,255,255),fixed:!0})}We(i),te()}),ne.curRecording&&Ue(()=>{O(),V(0,ve()),V(24,-24),$e({radius:12,color:Z(255,0,0),opacity:ai(0,1,x.time()*4),fixed:!0}),te()}),ne.showLog&&T.logs.length>0&&Ue(()=>{O(),V(0,ve()),V(8,-8);let e=8,i=[];for(let r of T.logs){let o="",u=r.msg instanceof Error?"error":"info";o+=`[time]${r.time.toFixed(2)}[/time]`,o+=" ",o+=`[${u}]${r.msg?.toString?r.msg.toString():r.msg}[/${u}]`,i.push(o)}T.logs=T.logs.filter(r=>x.time()-r.time<(n.logTime||yo));let s=Ye({text:i.join(`
`),font:yn,pos:B(e,-e),anchor:"botleft",size:16,width:Ae()*.6,lineSpacing:e/2,fixed:!0,styles:{time:{color:Z(127,127,127)},info:{color:Z(255,255,255)},error:{color:Z(255,0,127)}}});ce({width:s.width+e*2,height:s.height+e*2,anchor:"botleft",color:Z(0,0,0),radius:4,opacity:.8,fixed:!0}),We(s),te()})}a(Ts,"drawDebug");function Cs(e){T.events.on("loading",e)}a(Cs,"onLoading");function ks(e){x.onResize(e)}a(ks,"onResize");function Fs(e){T.events.on("error",e)}a(Fs,"onError");function gn(e){ee.ctx.suspend(),x.run(()=>{Ue(()=>{let i=Ae(),s=ve(),r={size:36,width:i-32*2,letterSpacing:4,lineSpacing:4,font:yn,fixed:!0};ce({width:i,height:s,color:Z(0,0,255),fixed:!0});let o=Ye({...r,text:"Error",pos:B(32),color:Z(255,128,0),fixed:!0});We(o),Ln({...r,text:e.message,pos:B(32,32+o.height+16),fixed:!0}),te(),T.events.trigger("error",e)})})}a(gn,"handleErr");function Ds(e){Y.push(e)}a(Ds,"onCleanup");function Is(){T.events.onOnce("frameEnd",()=>{x.quit();for(let i in bt)window.removeEventListener(i,bt[i]);c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT|c.STENCIL_BUFFER_BIT);let e=c.getParameter(c.MAX_TEXTURE_IMAGE_UNITS);for(let i=0;i<e;i++)c.activeTexture(c.TEXTURE0+i),c.bindTexture(c.TEXTURE_2D,null),c.bindTexture(c.TEXTURE_CUBE_MAP,null);c.bindBuffer(c.ARRAY_BUFFER,null),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,null),c.bindRenderbuffer(c.RENDERBUFFER,null),c.bindFramebuffer(c.FRAMEBUFFER,null),Y.forEach(i=>i()),c.deleteBuffer(v.vbuf),c.deleteBuffer(v.ibuf)})}a(Is,"quit");function wn(e,i,s,r,o=tn.linear){let u=0,g=[],w=Gn(()=>{u+=Ee();let m=Math.min(u/s,1);r(Ce(e,i,o(m))),m===1&&(w.cancel(),r(i),g.forEach(d=>d()))});return{get paused(){return w.paused},set paused(m){w.paused=m},onEnd(m){g.push(m)},then(m){return this.onEnd(m),this},cancel(){w.cancel()},finish(){w.cancel(),r(i),g.forEach(m=>m())}}}a(wn,"tween");let An=!0;x.run(()=>{K.loaded||Re()===1&&!An&&(K.loaded=!0,T.events.trigger("load")),!K.loaded&&n.loadingScreen!==!1||An?(Vt(),Ps(),yt()):(ne.paused||Qn(),Ms(),Vt(),Bs(),n.debug!==!1&&Ts(),yt()),An&&(An=!1),T.events.trigger("frameEnd")});function _n(){let e=P,i=c.drawingBufferWidth/e,s=c.drawingBufferHeight/e;if(n.letterbox){if(!n.width||!n.height)throw new k("Letterboxing requires width and height defined.");let r=i/s,o=n.width/n.height;if(r>o){let u=s*o,g=(i-u)/2;v.viewport={x:g,y:0,width:u,height:s}}else{let u=i/o,g=(s-u)/2;v.viewport={x:0,y:g,width:i,height:u}}return}if(n.stretch&&(!n.width||!n.height))throw new k("Stretching requires width and height defined.");v.viewport={x:0,y:0,width:i,height:s}}a(_n,"updateViewport");function $n(){x.onHide(()=>{n.backgroundAudio||ee.ctx.suspend()}),x.onShow(()=>{n.backgroundAudio||ee.ctx.resume()}),x.onResize(()=>{if(x.isFullscreen())return;let e=n.width&&n.height;e&&!n.stretch&&!n.letterbox||(h.width=h.offsetWidth*P,h.height=h.offsetHeight*P,_n(),e||(v.frameBuffer.free(),v.frameBuffer=new Fe(c.drawingBufferWidth,c.drawingBufferHeight),v.width=c.drawingBufferWidth/P,v.height=c.drawingBufferHeight/P))}),n.debug!==!1&&qi(),n.burp&&Ki()}a($n,"initEvents"),_n(),$n();let tt={VERSION:go,loadRoot:Ft,loadProgress:Re,loadSprite:Ie,loadSpriteAtlas:lt,loadSound:Ht,loadBitmapFont:Ut,loadFont:It,loadShader:Ot,loadShaderURL:Gt,loadAseprite:Nt,loadPedit:Lt,loadBean:jt,loadJSON:ln,load:rt,getSprite:ut,getSound:dt,getFont:ct,getBitmapFont:pt,getShader:ft,getAsset:qt,Asset:ue,SpriteData:oe,SoundData:we,width:Ae,height:ve,center:_t,dt:Ee,time:x.time,screenshot:x.screenshot,record:bs,isFocused:Es,setCursor:x.setCursor,getCursor:x.getCursor,setCursorLocked:x.setCursorLocked,isCursorLocked:x.isCursorLocked,setFullscreen:x.setFullscreen,isFullscreen:x.isFullscreen,isTouchscreen:x.isTouchscreen,onLoad:mn,onLoading:Cs,onResize:ks,onGamepadConnect:x.onGamepadConnect,onGamepadDisconnect:x.onGamepadDisconnect,onError:Fs,onCleanup:Ds,camPos:Ci,camScale:ki,camRot:Fi,shake:Di,toScreen:Nn,toWorld:On,setGravity:Yi,getGravity:Wi,setBackground:Xi,getBackground:zi,getGamepads:x.getGamepads,add:$t,make:dn,destroy:Ss,destroyAll:zr,get:Xn,readd:Xr,pos:Jt,scale:Zt,rotate:Qi,color:Ji,opacity:Zi,anchor:pn,area:ns,sprite:fn,text:is,rect:ss,circle:os,uvquad:rs,outline:as,body:ls,doubleJump:hs,shader:us,timer:jn,fixed:ds,stay:qn,health:cs,lifespan:ps,z:_i,move:es,offscreen:ts,follow:$i,state:fs,fadeIn:ms,mask:gs,tile:Wn,agent:xs,on:Le,onUpdate:Gn,onDraw:jr,onAdd:cn,onDestroy:Hn,onClick:Ni,onCollide:Ii,onCollideUpdate:Ui,onCollideEnd:Li,onHover:Oi,onHoverUpdate:Gi,onHoverEnd:Hi,onKeyDown:x.onKeyDown,onKeyPress:x.onKeyPress,onKeyPressRepeat:x.onKeyPressRepeat,onKeyRelease:x.onKeyRelease,onMouseDown:x.onMouseDown,onMousePress:x.onMousePress,onMouseRelease:x.onMouseRelease,onMouseMove:x.onMouseMove,onCharInput:x.onCharInput,onTouchStart:x.onTouchStart,onTouchMove:x.onTouchMove,onTouchEnd:x.onTouchEnd,onScroll:x.onScroll,onHide:x.onHide,onShow:x.onShow,onGamepadButtonDown:x.onGamepadButtonDown,onGamepadButtonPress:x.onGamepadButtonPress,onGamepadButtonRelease:x.onGamepadButtonRelease,onGamepadStick:x.onGamepadStick,mousePos:Wt,mouseDeltaPos:x.mouseDeltaPos,isKeyDown:x.isKeyDown,isKeyPressed:x.isKeyPressed,isKeyPressedRepeat:x.isKeyPressedRepeat,isKeyReleased:x.isKeyReleased,isMouseDown:x.isMouseDown,isMousePressed:x.isMousePressed,isMouseReleased:x.isMouseReleased,isMouseMoved:x.isMouseMoved,isGamepadButtonPressed:x.isGamepadButtonPressed,isGamepadButtonDown:x.isGamepadButtonDown,isGamepadButtonReleased:x.isGamepadButtonReleased,charInputted:x.charInputted,loop:ji,wait:Qt,play:At,volume:wt,burp:vt,audioCtx:ee.ctx,Timer:uo,Line:Bt,Rect:Ve,Circle:Ls,Polygon:xn,Vec2:E,Color:_,Mat4:Pe,Quad:me,RNG:tr,rand:sn,randi:fi,randSeed:nr,vec2:B,rgb:Z,hsl2rgb:eo,quad:re,choose:sr,chance:ir,lerp:Ce,tween:wn,easings:tn,map:Xe,mapc:er,wave:ai,deg2rad:Te,rad2deg:Pt,clamp:Ge,testLineLine:Mt,testRectRect:rr,testRectLine:ar,testRectPoint:rn,testCirclePolygon:hr,testLinePoint:lr,testLineCircle:mi,drawSprite:un,drawText:Ln,formatText:Ye,drawRect:ce,drawLine:xt,drawLines:Bn,drawTriangle:Pn,drawCircle:$e,drawEllipse:Tn,drawUVQuad:de,drawPolygon:Ke,drawFormattedText:We,drawMasked:kn,drawSubtracted:Fn,pushTransform:O,popTransform:te,pushTranslate:V,pushScale:S,pushRotate:j,pushMatrix:p,usePostEffect:hn,debug:ne,scene:ws,go:As,onSceneLeave:vs,addLevel:ys,getData:Vs,setData:Kn,download:Rn,downloadJSON:gr,downloadText:vi,downloadBlob:pi,plug:Yn,ASCII_CHARS:qs,canvas:x.canvas(),addKaboom:Rs,LEFT:E.LEFT,RIGHT:E.RIGHT,UP:E.UP,DOWN:E.DOWN,RED:_.RED,GREEN:_.GREEN,BLUE:_.BLUE,YELLOW:_.YELLOW,MAGENTA:_.MAGENTA,CYAN:_.CYAN,WHITE:_.WHITE,BLACK:_.BLACK,quit:Is,Event:Be,EventHandler:nn,EventController:Rt,KaboomError:k};if(n.plugins&&n.plugins.forEach(Yn),n.global!==!1)for(let e in tt)window[e]=tt[e];return n.focus!==!1&&x.canvas().focus(),tt},"default");var Ro=yr({background:[0,0,0],width:640,height:360,scale:2,stretch:!0,letterbox:!0}),l=Ro;function on(n){let t=Math.floor(n%3600/60),h=n%60;return`${String(t).padStart(2,"0")}:${String(h).padStart(2,"0")}`}var Mo=8,Bo=l.randi(150,200),Vi={};Vi[l.DOWN]=0;Vi[l.RIGHT]=270;var yi={};yi[l.DOWN]=5;yi[l.RIGHT]=20;function xr(n,t,h){l.add([l.sprite("arrow"),l.pos(n+Mo,t+yi[h]),l.scale(1.2),l.area({collisionIgnore:["arrow","wall","baseballBat"],scale:.5}),l.rotate(Vi[h]),l.z(2),l.anchor("center"),l.move(h,Bo),l.offscreen({destroy:!0}),"arrow","enemy","pauseAble"])}function br(n){return[l.sprite("health_flask",{anim:"hover"}),l.tile({}),l.scale(1.2),l.pos(n),l.area({scale:.6}),l.anchor("center"),"healthFlask"]}function xi(n){return[l.sprite("bomb"),l.pos(n),l.scale(.8),l.tile({}),l.area({scale:.6,offset:l.vec2(-2,6)}),l.anchor("center"),"bomb"]}var Er=n=>{let t=l.randi(-100,-20),h=l.randi(n.levelWidth()+20,n.levelWidth()+100),f=l.choose([t,h]),y=l.randi(n.levelHeight()-100,n.levelHeight()+100);return l.vec2(f,y)},Sr=n=>{let t=l.randi(-20,-100),h=l.randi(n.levelHeight()+20,n.levelHeight()+100),f=l.choose([t,h]),y=l.randi(-20,n.levelWidth()+20);return l.vec2(y,f)},Tt=n=>{let t=n.tileWidth()*2,h=n.tileHeight()*2,f=0,y=0;for(;n.getAt(l.vec2(f,y)).length!==0;)f=l.randi(t,n.levelWidth()-t),y=l.randi(h,n.levelHeight()-h);return l.vec2(f,y)};function Rr(n){return[l.sprite("sneakers"),l.tile({}),l.pos(n),l.scale(.5),l.area(),l.anchor("center"),"sneakers"]}var Po=.5,To=20,Co=60,ko=3,Fo=60,Do=60,Io=3,Uo=30,Lo=45,No=1,Oo=3,bi=(h=>(h[h.wallBottomArrow=l.DOWN]="wallBottomArrow",h[h.wallRightArrow=l.RIGHT]="wallRightArrow",h))(bi||{});function Mr(){let n=["ca        h             h             h             h         d"," g                                                             ","                                                 -             ","     n                                                         ","                                          n                    ","                                                               ","               -                                               ","                                                               ","                                                               ","                                                               ","                                                               ","                                                               ","             n                                   n             ","                                                               ","                                                               ","                                                               ","                                                               ","                                                               ","                                 n                             ","                                                               ","                                                               ","           n                                                   ","                                                               ","                             -                                 ","                                                           n   ","                                                               ","                                                               ","                                                               ","                                n                              ","                                                               ","                                                               ","   n                                               n           ","                                                               ","                                                               ","                        n                                      ","                                                               ","eb                                                            f"];Go(n);let t=Y=>[l.sprite("wall_top",{frame:~~l.rand(0,4),tiled:!0,width:Y,height:16}),l.body({isStatic:!0}),l.area(),"wall"],h=Y=>[l.sprite("wall_left",{frame:~~l.rand(0,4),tiled:!0,width:16,height:Y}),l.body({isStatic:!0}),l.area(),"wall"],f=Y=>[l.sprite("wall_bottom",{frame:~~l.rand(0,4),tiled:!0,width:Y,height:16}),l.body({isStatic:!0}),l.area(),"wall"],y=Y=>[l.sprite("wall_right",{frame:~~l.rand(0,4),tiled:!0,width:16,height:Y}),l.body({isStatic:!0}),l.area(),"wall"],M=()=>[l.sprite("wall_bottom_left",{frame:0}),"wall"],P=()=>[l.sprite("wall_bottom_right",{frame:0}),"wall"],q=()=>[l.sprite("wall_bottom_arrow",{tiled:!0,width:16,height:16}),l.body({isStatic:!0}),l.area(),"wall","wallBottomArrow"],W=()=>l.chance(Po)?[l.sprite("spears",{anim:"peak"}),l.area({scale:.6}),l.anchor("center"),"spears"]:null,x=l.addLevel(n,{tileWidth:16,tileHeight:16,tiles:{a:()=>t(992),b:()=>f(976),c:()=>h(576),d:()=>y(576),e:()=>M(),f:()=>P(),g:()=>[l.sprite("floor",{frame:8,tiled:!0,width:976,height:560})],h:()=>[l.sprite("torch_front",{anim:"burn"})],j:()=>t(16),k:()=>h(32),l:()=>q(),m:()=>[...y(32),"wallRightArrow"],n:()=>W(),o:()=>[l.sprite("lava",{anim:"flow"})]}});return Ho(x),jo(x),qo(x),Ko(x),x}function Go(n){let t,h,f;n.forEach((y,M)=>{if(M===h){let P="o";n[M]=y.substring(0,f+1)+P+y.substring(f+P.length+1)}else if(M===t){let P="elf";n[M]=y.substring(0,f)+P+y.substring(f+P.length)}else{let P=y.indexOf("-");P!==-1&&(n[M]=y.split("-  ").join("kjm"),f=P,h=M+1,t=M+2)}})}function Ho(n){l.wait(To,()=>{l.loop(Co,()=>{!n.paused&&n.get("healthFlask").length<ko&&n.add(br(Tt(n)))})})}function jo(n){l.wait(Fo,()=>{l.loop(Do,()=>{!n.paused&&n.get("bomb").length+l.get("bombUi").length<Io&&n.add(xi(Tt(n)))})})}function qo(n){l.wait(Uo,()=>{l.loop(Lo,()=>{!n.paused&&n.get("sneakers").length<No&&n.add(Rr(Tt(n)))})})}function Ko(n){Object.values(bi).filter(h=>typeof h=="string").forEach(h=>{n.get(h).forEach(f=>{l.wait(Oo,()=>{l.loop(l.randi(3,5),()=>{n.paused||xr(f.pos.x,f.pos.y,bi[h])})})})})}var Yo=l.randi(55,65);function Br(n,t){let h=l.make([l.sprite("skull"),l.pos(t),l.rotate(0),l.area({scale:.7,collisionIgnore:["wall","arrow"]}),l.body(),l.scale(1.5),l.anchor("center"),l.z(2),"skull","enemy","pauseAble"]);return h.play("move"),h.onUpdate(()=>{if(!n.exists())return;let f,y=l.get("explodingBomb");if(y.length!==0){let M=y.pop();h.flipX=M.pos.x<h.pos.x,f=M.pos.sub(h.pos).unit()}else h.flipX=n.pos.x<h.pos.x,f=n.pos.sub(h.pos).unit();h.move(f.scale(Yo))}),h}function st(n){let t=l.add([l.rect(n.width*1.2,n.height*1.2,{radius:4}),l.pos(n.pos),l.opacity(.3),l.fixed(),l.scale(n.scale),l.anchor("center"),l.outline(3),l.z(n.z-1)]);n.onDestroy(()=>{t.destroy()})}function Mn(n){let t=l.add([l.sprite("heart"),l.scale(.5),l.pos(20*n,15),l.fixed(),l.anchor("center"),l.z(100),"heart"]);st(t)}function Pr(n){let t=["player","baseballBat","wall","enemy"],h=n.pos.angle(l.toWorld(l.mousePos())),f=30<h&&h<130,y=-30>h&&h>-130,M=(y?90:0)+(f?270:0),P=l.add([l.sprite("baseball_bat"),l.scale(.5),l.pos(),l.rotate(M),l.body(),l.anchor("center"),l.area({collisionIgnore:t}),"baseballBat","pauseAble"]);return f||y?P.anchor="left":(P.flipX=n.flipX,P.anchor=n.flipX?"right":"left"),P.onAnimStart(()=>{t.pop(),P.collisionIgnore=t}),P.onAnimEnd(()=>{t.push("enemy"),P.collisionIgnore=t,P.destroy()}),l.onClick(()=>{!P.curAnim()&&!P.paused&&P.play("swing")}),P.onUpdate(()=>{P.pos=l.vec2(n.pos.x,n.pos.y),n.exists()||P.destroy()}),P}function Tr(n){l.add([l.sprite("lava",{anim:"flow"}),l.pos(n.pos),l.anchor("center"),l.area({scale:.8}),"lava"]),l.add([l.sprite("hole"),l.pos(n.pos),l.anchor("center")])}var Cr=120,kr=60,Wo=100;function Fr(n){let t=l.add([l.sprite("exploding_bomb"),l.pos(n.pos.x+(n.flipX?-n.width/2:n.width/2),n.pos.y),l.scale(.8),l.body({mass:Wo}),l.area({collisionIgnore:["baseballBat","arrow"],scale:.5}),l.anchor("center"),"explodingBomb","pauseAble"]);t.onAnimStart(()=>{let h;l.play("match-strike",{volume:1.5}).onEnd(()=>{h=l.play("burning-fuse",{volume:1.5})}),l.wait(3.8,()=>{h.stop(),l.shake(8),l.play("explosion",{volume:.4}),l.get("skull").forEach(M=>{t.pos.dist(M.pos)<=Cr&&M.destroy()});let y=t.pos.dist(n.pos);y<=Cr&&y>=kr?n.hurt(2):y<kr&&n.hurt(n.maxHP()),Tr(t)})}),t.onAnimEnd(()=>{t.destroy()}),!t.curAnim()&&!t.paused&&t.play("explode")}var Dr=120,Xo=200,zo=100,Qo=3,Jo=5,Ct=Dr;function Ir(){let n=l.add([l.sprite("player"),l.anchor("center"),l.pos(l.center()),l.scale(.8),l.area({scale:.6}),l.body({mass:zo}),l.health(Qo),l.z(2),"player","pauseAble"]);return $o(n),_o(n),Zo(n),n.onUpdate(()=>{l.camPos(n.pos),n.flipX=l.mousePos().x<n.screenPos().x}),n.on("speedBoost",()=>{Ct=Xo,l.wait(Jo,()=>{Ct=Dr})}),n}function Zo(n){for(let t=1;t<n.hp()+1;t++)Mn(t);n.onHurt(t=>{l.shake(5),n.hp()>0&&l.play("damage");let h=l.get("heart");for(let f=1;f<t+1;f++)h.pop()?.destroy()}),n.onHeal(()=>{l.play("health-pickup")})}function _o(n){let t=l.add([l.circle(6),l.pos(),l.color(l.rgb(0,0,0)),l.opacity(.25),l.anchor("top")]);t.onUpdate(()=>{n.exists()||t.destroy(),t.pos=l.vec2(n.pos.x,n.pos.y+5)})}function $o(n){n.play("idle"),l.onKeyDown(h=>{n.paused||(h==="a"&&n.move(-Ct,0),h==="d"&&n.move(Ct,0),h==="w"&&n.move(0,-Ct),h==="s"&&n.move(0,Ct),n.curAnim()!=="move"&&n.play("move"))}),l.onKeyRelease(()=>{l.isKeyDown()||n.move(0,0)}),["left","right","up","down"].forEach(()=>{l.onKeyRelease(h=>{!l.isKeyDown(h)&&n.curAnim()!=="idle"&&n.play("idle")})}),l.onKeyRelease("space",()=>{if(!n.paused){let h=l.get("bombUi").length>0,f=l.get("explodingBomb").length===0;h&&f&&(Fr(n),l.get("bombUi").pop()?.destroy())}});let t;l.onClick(()=>{!n.paused&&!t?.exists()&&(t=Pr(n))})}var Ur=l.height()/4;function Ei(n,t){let h=l.add([l.pos(l.camPos().add(0,Ur)),l.text(n,{size:12,font:"PressStart2p"}),l.anchor("center"),l.lifespan(5,{fade:5}),l.z(100),"txtBelow",t]);h.onUpdate(()=>{h.pos=l.camPos().add(0,Ur)})}function Lr(){let n=l.add([l.pos(),l.text("PAUSED",{size:18,font:"PressStart2p"}),l.anchor("center"),l.z(100)]);return n.hidden=!0,n.on("paused",t=>{n.hidden=!t,n.pos=l.toWorld(l.center())}),n}function Nr(n){let t=l.add([l.sprite("bomb"),l.scale(.5),l.pos(20*n,35),l.fixed(),l.anchor("center"),l.z(100),"bombUi"]);st(t)}function Or(){let n=0,t=l.add([l.pos(l.width()/2,10),l.text(on(n),{size:12,font:"PressStart2p"}),l.anchor("center"),l.fixed(),l.scale(1),l.z(100),"timer","pauseAble"]);return t.on("end",()=>{t.paused=!0;let h=l.getData("highscore");n>h&&l.setData("highscore",n)}),l.loop(1,()=>{t.paused||(t.text=on(++n))}),st(t),t}var kt=!1,ea=2;function Gr(){l.setBackground(0,0,0);let n=l.play("battle",{loop:!0}),t=Mr(),h=Ir();l.loop(1,()=>{kt||ta(t,h)}),ia(t),na(h);let f=Or();h.onDeath(()=>{n.stop(),f.trigger("end"),l.play("death").onEnd(()=>{l.go("menu")}),h.destroy()}),h.pos=Tt(t)}function ta(n,t){let h=l.choose([()=>Er(n),()=>Sr(n)]),f=Br(t,h());l.add(f),f.onCollide("baseballBat",()=>{l.play("swoosh",{volume:.5}),f.destroy()})}function na(n){n.onCollide("skull",()=>{n.hurt(1)}),n.onCollide("arrow",()=>{n.hurt(2)}),n.onCollide("lava",()=>{n.hurt(n.maxHP())}),n.onCollide("spears",()=>{n.hurt(n.maxHP())}),n.onCollide("healthFlask",t=>{n.hp()<3?(Mn(n.hp()+1),n.heal(),t.destroy()):l.get("txtHealthFull").length===0&&(l.get("txtBelow").pop()?.destroy(),Ei("Full Health","txtHealthFull"))}),n.onCollide("bomb",t=>{let h=l.get("bombUi").length;h<ea?(Nr(h+1),l.play("bomb-pickup"),t.destroy()):l.get("txtBombsFull").length===0&&(l.get("txtBelow").pop()?.destroy(),Ei("You can't carry more","txtBombsFull"))}),n.onCollide("sneakers",t=>{l.play("sneakers-pickup"),t.destroy(),n.trigger("speedBoost")})}function ia(n){let t=Lr();l.onKeyRelease("p",()=>{kt=!kt,n.paused=kt,l.get("pauseAble").forEach(h=>{h.paused=kt}),t.trigger("paused",kt)})}function Si(n,t){let h=l.add([l.rect(l.width()/8,l.height()/8),l.pos(l.center()),l.area(),l.scale(1),l.anchor("center"),l.outline(2),l.color(32,156,238)]);return h.add([l.text(n,{font:"PressStart2p",...t}),l.anchor("center"),l.color(255,255,255)]),h.onHoverUpdate(()=>{h.scale=l.vec2(1.1),l.setCursor("pointer")}),h.onHoverEnd(()=>{h.scale=l.vec2(1),l.setCursor("default")}),h}function Hr(){l.setBackground(255,255,255);let n=l.play("menu",{loop:!0,volume:.2}),t=Si("START",{size:12}),h=l.getData("highscore");h?l.add([l.text(`Highscore: ${on(h)}`,{size:14,font:"PressStart2p",align:"center"}),l.pos(l.vec2(t.pos.x,t.pos.y-80)),l.anchor("center"),l.color(0,0,0)]):l.setData("highscore",0);let f=l.add([l.text("Movement",{size:12,font:"PressStart2p",align:"center"}),l.pos(l.vec2(t.pos.x,t.pos.y+60)),l.anchor("center"),l.color(0,0,0)]);l.add([l.text(`
w = UP
a = LEFT
s = DOWN
d = RIGHT

Mouse Click = ATTACK
Space = DROP BOMB
p = PAUSE
        `,{size:8,font:"PressStart2p",align:"center"}),l.pos(l.vec2(f.pos.x,f.pos.y+50)),l.anchor("center"),l.color(0,0,0)]),t.onClick(()=>{n.stop(),l.go("game")})}sa();function sa(){aa(),oa(),ra(),la(),l.scene("game",Gr),l.scene("menu",Hr),l.go("menu")}function ra(){l.loadFont("PressStart2p","fonts/PressStart2P-Regular.ttf")}function oa(){l.loadSound("battle","sound/battle.wav"),l.loadSound("menu","sound/menu.wav"),l.loadSound("damage","sound/damage.ogg"),l.loadSound("death","sound/death.wav"),l.loadSound("burning-fuse","sound/burning-fuse.wav"),l.loadSound("match-strike","sound/match-strike.wav"),l.loadSound("health-pickup","sound/health-pickup.wav"),l.loadSound("bomb-pickup","sound/bomb-pickup.wav"),l.loadSound("explosion","sound/explosion.wav"),l.loadSound("sneakers-pickup","sound/sneakers-pickup.wav"),l.loadSound("swoosh","sound/swoosh.wav")}function aa(){l.loadSprite("player","sprites/spritesheet/kid-male-spritesheet.png",{sliceX:12,anims:{idle:{from:0,to:5,loop:!0},move:{from:6,to:11,loop:!0}}}),l.loadSprite("skull","sprites/spritesheet/skull-v2-spritesheet.png",{sliceX:4,anims:{move:{from:0,to:3,loop:!0}}}),l.loadSprite("baseball_bat","sprites/spritesheet/bat-swing-spritesheet.png",{sliceX:3,anims:{swing:{from:0,to:2,loop:!1}}}),l.loadSprite("torch_front","sprites/spritesheet/torch-1-spritesheet.png",{sliceX:4,anims:{burn:{from:0,to:3,loop:!0}}}),l.loadSprite("health_flask","sprites/spritesheet/flask-health-spritesheet.png",{sliceX:4,anims:{hover:{from:0,to:3,loop:!0,speed:3}}}),l.loadSprite("spears","sprites/spritesheet/spears-spritesheet.png",{sliceX:4,anims:{peak:{from:0,to:3,loop:!0,speed:3}}}),l.loadSprite("exploding_bomb","sprites/spritesheet/bomb-spritesheet.png",{sliceX:40,anims:{explode:{from:0,to:39,loop:!1}}}),l.loadSprite("lava","sprites/spritesheet/lava-spritesheet.png",{sliceX:45,anims:{flow:{from:0,to:44,loop:!0}}}),l.loadSprite("wall_bottom_arrow","sprites/wall-bottom-arrow.png"),l.loadSprite("arrow","sprites/arrow.png"),l.loadSprite("bomb","sprites/bomb.png"),l.loadSprite("sneakers","sprites/sneakers.png"),l.loadSprite("hole","sprites/hole.png"),l.loadSpriteAtlas("sprites/dungeon-tileset.png","sprites/dungeonTileset.json"),l.loadSpriteAtlas("sprites/dungeon-ui-tileset.png","sprites/dungeonUiTileset.json")}function la(){l.loadShader("crt",void 0,`
uniform float u_flatness;
uniform float u_scanline_height;
uniform float u_screen_height;

vec4 frag(vec2 pos, vec2 uv, vec4 color, sampler2D tex) {
	vec2 center = vec2(0.5, 0.5);
	vec2 off_center = uv - center;
	vec2 uv2 = center + off_center;
	if (uv2.x > 1.0 || uv2.x < 0.0 || uv2.y > 1.0 || uv2.y < 0.0) {
		return vec4(0.0, 0.0, 0.0, 1.0);
	} else {
		vec4 c = vec4(texture2D(tex, uv2).rgb, 1.0);
		float fv = fract(uv2.y * 120.0);
		fv = min(1.0, 0.8 + 0.5 * min(fv, 1.0 - fv));
		c.rgb *= fv;
		return c;
	}
}
`),l.usePostEffect("crt")}})();
